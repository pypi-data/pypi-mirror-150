Metadata-Version: 2.1
Name: pptb
Version: 0.2.0
Summary: ğŸš£ ä¸€äº›å¸¸ç”¨çš„ä½† paddle é‡Œæ²¡æœ‰çš„å°å·¥å…·ï½
Home-page: https://github.com/cattidea/paddle-toolbox
License: MIT
Keywords: python,paddle,toolbox
Author: Nyakku Shigure
Author-email: sigure.qaq@gmail.com
Requires-Python: >=3.7,<4.0
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.7
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Provides-Extra: paddle
Requires-Dist: paddlepaddle (>=2.3.0,<3.0.0); extra == "paddle"
Project-URL: Bug Tracker, https://github.com/cattidea/paddle-toolbox/issues
Project-URL: Repository, https://github.com/cattidea/paddle-toolbox
Description-Content-Type: text/markdown

# Paddle Toolbox [Early WIP]

ä¸€äº›æ–¹ä¾¿çš„å°å·¥å…·ï¼Œå‚è€ƒ Paddle çš„ API è®¾è®¡ä»¥åŠ Torch Toolbox API è®¾è®¡

:warning: ç›®å‰æ­£å¤„äºæ—©æœŸè®¾è®¡é˜¶æ®µï¼Œå¤§å¤šæ•°åŠŸèƒ½çš„å¼€å‘æ–¹æ¡ˆå°šå¤„äºè‰æ¡ˆé˜¶æ®µï½

## å®‰è£…

### ä½¿ç”¨ pip å®‰è£…

æ³¨æ„ï¼šPython éœ€è‡³å°‘ 3.7.0 ç‰ˆæœ¬ï¼ŒPaddlePaddle éœ€è‡³å°‘ 2.3.0 ç‰ˆæœ¬ï¼ˆä¼šè·Ÿéš paddle ç‰ˆæœ¬å˜åŒ–ï¼‰

```bash
pip install pptb==0.2.0
```

ç”±äºä»å¤„äºæ—©æœŸå¼€å‘è®¾è®¡é˜¶æ®µï¼ŒAPI è¾ƒä¸ºä¸ç¨³å®šï¼Œå®‰è£…æ—¶è¯·**ä¸€å®šè¦æŒ‡å®šç‰ˆæœ¬å·**

### ç›´æ¥ä» GitHub æ‹‰å–æœ€æ–°ä»£ç 

è¿™é‡Œä»¥ AI Studio ä¸ºä¾‹

```bash
git clone https://github.com/cattidea/paddle-toolbox.git work/paddle-toolbox/
# å¦‚æœä¸‹è½½å¤ªæ…¢å¯¼è‡´å‡ºé”™è¯·ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤
# git clone https://hub.fastgit.org/cattidea/paddle-toolbox.git work/paddle-toolbox/
```

ä¹‹ååœ¨ä½ çš„ Notebook æˆ–è€… Python æ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç 

```python
import sys

sys.path.append('/home/aistudio/work/paddle-toolbox/')
```

## å·²æ”¯æŒçš„å·¥å…·

### LabelSmoothingLoss

```python
import paddle
from pptb.nn import LabelSmoothingLoss, LabelSmoothingCrossEntropyLoss

label_smooth_epision = 0.1

loss_function = paddle.nn.CrossEntropyLoss()
# å¦‚æœéœ€è¦æ ‡ç­¾å¹³æ»‘å Lossï¼Œå°†ä¸‹é¢è¿™è¡Œæ›¿æ¢æˆåé¢é‚£ä¸€è¡Œå³å¯
loss_function = LabelSmoothingLoss(
   paddle.nn.CrossEntropyLoss(soft_label=True),
   label_smooth_epision
)
# ç”±äº CrossEntropyLoss çš„ LabelSmoothing æ¯”è¾ƒå¸¸ç”¨ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™ä¸ªåˆ«å
loss_function = LabelSmoothingCrossEntropyLoss(label_smooth_epision)
```

### CosineWarmup

```python
import paddle
from pptb.optimizer.lr import CosineWarmup

# ...

train_batch_size = 32
learning_rate = 3e-4
step_each_epoch = len(train_set) // train_batch_size
num_epochs = 40
warmup_epochs = 3

lr_scheduler = CosineWarmup(
    learning_rate,
    total_steps = num_epochs * step_each_epoch,
    warmup_steps = warmup_epochs * step_each_epoch,
    warmup_start_lr = 0.0,
    cosine_end_lr = 0.0,
    last_epoch = -1
)

```

### Mixup && Cutmix

#### Mixup

```python
import paddle
from pptb.tools import mixup_data, mixup_criterion, mixup_metric

# ...

use_mixup = True
mixup_alpha = 0.2

for X_batch, y_batch in train_loader():
   # ä½¿ç”¨ mixup ä¸ä¸ä½¿ç”¨ mixup ä»£ç çš„å‰å‘ä¼ æ’­éƒ¨åˆ†ä»£ç å·®å¼‚å¯¹æ¯”
   if use_mixup:
      X_batch_mixed, y_batch_a, y_batch_b, lam = mixup_data(X_batch, y_batch, mixup_alpha)
      predicts = model(X_batch_mixed)
      loss = mixup_criterion(loss_function, predicts, y_batch_a, y_batch_b, lam)
      acc = mixup_metric(paddle.metric.accuracy, predicts, y_batch_a, y_batch_b, lam)
   else:
      predicts = model(X_batch)
      loss = loss_function(predicts, y_batch)
      acc = paddle.metric.accuracy(predicts, y_batch)

   # ...
```

é™¤äº†ç”¨äºå¤„ç† paddle é‡Œ `Tensor` çš„ `mixup_data`ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ `mixup_data_numpy` å¤„ç† numpy çš„ ndarrayã€‚

#### Cutmix

å’Œ Mixup ä¸€æ ·ï¼Œåªéœ€è¦å°† `mixup_data` æ¢ä¸º `cutmix_data` å³å¯ï¼Œä¸ `mixup_data` ä¸åŒçš„æ˜¯ï¼Œ`cutmix_data` è¿˜æ¥æ”¶ä¸€ä¸ªé¢å¤–å‚æ•° `axes` ç”¨äºæ§åˆ¶éœ€è¦ mix çš„æ˜¯å“ªå‡ æ ¹ axisï¼Œé»˜è®¤ `axes = [2, 3]`ï¼Œä¹Ÿå³ `NCHW` æ ¼å¼å›¾ç‰‡æ•°æ®å¯¹åº”çš„ `H` ä¸ `W` ä¸¤æ ¹ axisã€‚

#### MixingDataController

ç”¨äºæ–¹ä¾¿ç®¡ç†ä½¿ç”¨ Mixup å’Œ Cutmix

```python
import paddle
from pptb.tools import MixingDataController

# ...

mixing_data_controller = MixingDataController(
   mixup_prob=0.3,
   cutmix_prob=0.3,
   mixup_alpha=0.2,
   cutmix_alpha=0.2,
   cutmix_axes=[2, 3],
   loss_function=paddle.nn.CrossEntropyLoss(),
   metric_function=paddle.metric.accuracy,
)

for X_batch, y_batch in train_loader():
   X_batch_mixed, y_batch_a, y_batch_b, lam = mixing_data_controller.mix(X_batch, y_batch, is_numpy=False)
   predicts = model(X_batch_mixed)
   loss = mixing_data_controller.loss(predicts, y_batch_a, y_batch_b, lam)
   acc = mixing_data_controller.metric(predicts, y_batch_a, y_batch_b, lam)

   # ...
```

### Vision models

æä¾›æ›´åŠ ä¸°å¯Œçš„ backboneï¼Œæ‰€æœ‰æ¨¡å‹å‡ä¼šæä¾›é¢„è®­ç»ƒæƒé‡

åˆå…¥ paddle ä¸»çº¿çš„æ¨¡å‹ä¼šåœ¨æ–°ç‰ˆæœ¬å‘å¸ƒæ—¶ç§»é™¤ï¼Œé¿å… API ä¸åŒæ­¥å¯¼è‡´çš„é—®é¢˜

å·²æ”¯æŒä¸€äº› PaddleClas ä¸‹çš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œä»¥åŠæ¯”è¾ƒæ–°çš„ ConvMixer

-  GoogLeNetï¼ˆå·²å¹¶å…¥ paddle ä¸»çº¿ä¸”å·²ç§»é™¤ï¼Œè¯·ç›´æ¥ä½¿ç”¨ paddle.vision.models.GoogLeNetï¼‰
-  Incetpionv3ï¼ˆå·²å¹¶å…¥ paddle ä¸»çº¿ä¸”å·²ç§»é™¤ï¼Œè¯·ç›´æ¥ä½¿ç”¨ paddle.vision.models.InceptionV3ï¼‰
-  ResNeXtï¼ˆå·²å¹¶å…¥ paddle ä¸»çº¿ä¸”å·²ç§»é™¤ï¼Œè¯·ç›´æ¥ä½¿ç”¨ paddle.vision.models.ResNetï¼‰
-  ShuffleNetV2ï¼ˆå·²å¹¶å…¥ paddle ä¸»çº¿ä¸”å·²ç§»é™¤ï¼Œè¯·ç›´æ¥ä½¿ç”¨ paddle.vision.models.ShuffleNetV2ï¼‰
-  MobileNetV3ï¼ˆå·²å¹¶å…¥ paddle ä¸»çº¿ä¸”å·²ç§»é™¤ï¼Œè¯·ç›´æ¥ä½¿ç”¨ paddle.vision.models.MobileNetV3Large å’Œ paddle.vision.models.MobileNetV3Smallï¼‰
-  ConvMixerï¼ˆé¢„è®­ç»ƒæƒé‡è½¬è‡ª PyTorchï¼‰

```python
import paddle
import pptb.vision.models as ppmodels

model = ppmodels.convmixer_768_32(pretrained=True)
```

PS: å¦‚æœè¿™äº›æ¨¡å‹æ— æ³•æ»¡è¶³ä½ çš„éœ€æ±‚çš„è¯ï¼Œå¯ä»¥è¯•è¯•å›Šæ‹¬äº†å¾ˆå¤šæ¯”è¾ƒæ–°çš„æ¨¡å‹çš„ [ppim](https://github.com/AgentMaker/Paddle-Image-Models)~

#### ConvMixer

| Model Name                | Kernel Size | Patch Size | Top-1                                                 | Top-5  |
| ------------------------- | ----------- | ---------- | ----------------------------------------------------- | ------ |
| convmixer_768_32          | 7           | 7          | 0.7974<span style="color:green;"><sub>(-0.0042)</sub> | 0.9486 |
| convmixer_1024_20_ks9_p14 | 9           | 14         | 0.7681<span style="color:green;"><sub>(-0.0013)</sub> | 0.9335 |
| convmixer_1536_20         | 9           | 7          | 0.8083<sub><span style="color:green;">(-0.0054)</sub> | 0.9557 |

### TODO List

ä¸€äº›è¿‘æœŸæƒ³åšçš„åŠŸèƒ½

-  [x] Cutmix
-  [ ] Activationã€Mish
-  [ ] RandomErasing
-  [ ] AutoAugmentã€RandAugment
-  [ ] Transform Layerï¼ˆä½¿ç”¨ Layer å®ç°æŸäº› Transformï¼‰
-  [ ] æ›´å¤š vision models
   -  [ ] Xception
   -  [ ] Swin Transformer
   -  [ ] CvT
-  [ ] å®Œæ•´çš„å•å…ƒæµ‹è¯•

## References

-  [PaddlePaddle](https://github.com/PaddlePaddle/Paddle)
-  [Torch Toolbox](https://github.com/PistonY/torch-toolbox)
-  [pytorch-image-models](https://github.com/rwightman/pytorch-image-models)


debug: false

#    """
#    Steps
#    Copy the full Parent client aggr tables as-is into the demo/aggr (OVERWRITE)
#    Get incrementals comparing the full against the history
#    note: the result will be different from the parent incremental since the history is different (the load frequency can be different from the parent).
#    note: the comparison still use the hash value created for the parent table (so there isn't any comparison with the anonymized values)
#    Compare the master-anonimyzed-members , against the incremental (member_id field)
#      if the member_id doesnâ€™t exist add to it and assign  anonymized names and addresses.
#    Replace in the incremental the master anonymized data
#    Save the new incremental
#    """

## Files to Load / Create View
variables:
  - project_root_path = {config.project_root_path}
  #  - cad_job_id = {config.job_id}
  - client = {config.client}
  - parent_demo_client = {config.project_config.parent_demo_client}
  - aggr_location =  {config.aggr_location}
  - debug = False

Extract:

#history tables in the demo client
  members_history:
    type: parquet
    location: "{aggr_location}/members_history/"

  member_index_history:
    type: parquet
    location: "{aggr_location}/member_index_history/"

#full tables from the parent client
  members_full:
    type: parquet
    location: "{project_root_path}/{parent_demo_client}/aggr/members_full/"

  member_index_full:
    type: parquet
    location: "{project_root_path}/{parent_demo_client}/aggr/member_index_full/"

#anonymize tables
  firstnames:
    type: parquet
    location: "{project_root_path}/{parent_demo_client}/firstnames/"

  lastnames:
    type: parquet
    location: "{project_root_path}/{parent_demo_client}/lastnames/"

  cities:
    type: parquet
    location: "{project_root_path}/{parent_demo_client}/cities/"

  streets:
    type: parquet
    location: "{project_root_path}/{parent_demo_client}/streets/"

  states:
    type: parquet
    location: "{project_root_path}/{parent_demo_client}/states/"

#master demo anonymize names, mbi, hicn  and address
  anonymized_member_master:
    type: parquet
    location: "{project_root_path}/{client}/aggr/anonymized_member_master/"

#job for the demo client
  job:
    type: postgres
    conn_config_name: cadmium_postgres_db
    table_name: job

Transform:
  cad_job:
    sql: >-
      With LastJob as (
        SELECT
          max(id) as last_job_id,
          max(client_name) as client_name
          FROM job
          WHERE status = 'CLOSED' and client_name ='{client}'
        )
      SELECT
        max(j.id) as cad_job_id, max(coalesce(l.last_job_id,0)) as last_job_id
        FROM job j
        inner join LastJob l on j.client_name = l.client_name
        WHERE status = 'OPEN'
    cache: true

# previous job should ONLY include the table keys , hash values and job id for the previous job_id for the specific client
  previous_load_members:
    sql: >-
      SELECT
         member_id,
         hash_value,
         job_id
      FROM members_history m
      INNER JOIN cad_job  c on c.last_job_id =m.job_id

  previous_load:
    sql: >-
      SELECT
         member_id,
         hash_value,
         job_id
      FROM member_index_history m
      INNER JOIN cad_job  c on c.last_job_id =m.job_id

#get incremental
  members_incremental:
    sql: >-
      WITH new_rows as (
           SELECT
            a.hash_value,
            'INSERT' as operation,
            a.job_id,
            a.load_year,
            a.load_month,
            a.member_id,
            a.hicn,
            a.mbi,
            a.external_member_id,
            a.full_name,
            a.first_name,
            a.last_name,
            a.gender,
            a.date_of_birth,
            a.age,
            a.health_plan_member_id,
            a.health_plan_name,
            a.address_line_1,
            a.address_line_2,
            a.city,
            a.zip,
            a.state,
            a.phone,
            a.program,
            a.pcp_id,
            a.chart_delivered_count,
            a.flex1,
            a.flex2,
            a.flex3,
            a.flex4,
            a.flex5,
            a.flex6,
            a.flex7,
            a.flex8,
            a.flex9,
            a.flex10
          FROM  members_full a
          LEFT JOIN  previous_load_members b on a.member_id = b.member_id
          WHERE b.member_id is null ),
      delete_rows as (
          SELECT
             a.hash_value,
             'DELETE' as operation,
              ( select cad_job_id from cad_job )  as job_id,
             cast(null as integer) as load_year,
             cast(null as integer) as load_month,
             a.member_id,
            cast(null as string) as hicn,
            cast(null as string) as mbi,
            cast(null as string) as external_member_id,
            cast(null as string) as full_name,
            cast(null as string) as first_name,
            cast(null as string) as last_name,
            cast(null as string) as gender,
            cast(null as date) as date_of_birth,
            cast(null as integer) as age,
            cast(null as string) as health_plan_member_id,
            cast(null as string) as health_plan_name,
            cast(null as string) as address_line_1,
            cast(null as string) as address_line_2,
            cast(null as string) as city,
            cast(null as string) as zip,
            cast(null as string) as state,
            cast(null as string) as phone,
            cast(null as string) as program,
            cast(null as string) as pcp_id,
            cast(null as integer) as chart_delivered_count,
            cast(null as string) as flex1,
            cast(null as string) as flex2,
            cast(null as string) as flex3,
            cast(null as string) as flex4,
            cast(null as string) as flex5,
            cast(null as string) as flex6,
            cast(null as string) as flex7,
            cast(null as string) as flex8,
            cast(null as string) as flex9,
            cast(null as string) as flex10
          FROM  previous_load_members a
          LEFT JOIN  members_full  b on a.member_id = b.member_id
          WHERE b.member_id is null ),
      update_rows as (
          SELECT
             a.hash_value,
             'UPDATE' as operation,
             a.job_id,
             a.load_year,
             a.load_month,
            a.member_id,
            a.hicn,
            a.mbi,
            a.external_member_id,
            a.full_name,
            a.first_name,
            a.last_name,
            a.gender,
            a.date_of_birth,
            a.age,
            a.health_plan_member_id,
            a.health_plan_name,
            a.address_line_1,
            a.address_line_2,
            a.city,
            a.zip,
            a.state,
            a.phone,
            a.program,
            a.pcp_id,
            a.chart_delivered_count,
            a.flex1,
            a.flex2,
            a.flex3,
            a.flex4,
            a.flex5,
            a.flex6,
            a.flex7,
            a.flex8,
            a.flex9,
            a.flex10
           FROM   members_full  a
           INNER JOIN previous_load_members b on a.member_id = b.member_id
           WHERE a.hash_value <> b.hash_value )
      SELECT *
      FROM new_rows
      UNION
      SELECT *
      FROM delete_rows
      UNION
      SELECT *
      FROM update_rows
    cache: true

 # check incremental members are present in the anonymized_member_master
  new_rows_anonymized_member_master:
    sql: >-
      with new_members as (
                select v.member_id, v.Last_name, v.first_name, v.address_line_1 as address_1,
                translate(v.mbi, '0123456789ABCDEFGHIJKLMNOPQRSTUVWXWZ',   '4567893345WEASDDURHVHJXKJCHKXZZLCJHM') AS mbi ,
                translate(v.hicn, '0123456789ABCDEFGHIJKLMNOPQRSTUVWXWZ',   '4567893345WEASDDURHVHJXKJCHKXZZLCJHM') AS  hicn,
                translate(v.external_member_id, '0123456789ABCDEFGHIJKLMNOPQRSTUVWXWZ',   '4567893345WEASDDURHVHJXKJCHKXZZLCJHM') as external_member_id,
                translate(v.health_plan_member_id, '0123456789ABCDEFGHIJKLMNOPQRSTUVWXWZ',   '4567893345WEASDDURHVHJXKJCHKXZZLCJHM') as health_plan_member_id
                from members_incremental  v
                left join anonymized_member_master i on v.member_id = i.member_id
                where i.member_id is null
          ),
            m_rank as
            ( select member_id,
            row_number() over (order by Last_Name) as o_last,
            row_number() over (order by First_Name) as o_first,
            row_number() over (order by Address_1) as o_street
            from new_members ),
          m_rank_index as
            ( select member_id,
            case when (o_last % 5000) > 0 then  (o_last % 5000) else 5000 end  as l_index,
            case when (o_first % 5000) > 0 then   (o_first % 5000)  else 5000 end as f_index,
            case when (o_street % 5000) > 0  then (o_street % 5000) else 5000 end as st_index,
            case when (o_last % 475) > 0 then  (o_last % 475) else 475 end as c_index,
            case when (o_street % 67) > 0 then  (o_street % 67) else 67 end  as s_index
            from m_rank
          ),
          rank_firstnames as (select * ,  row_number() over (order by first_name) as r_first from firstnames ),
          rank_lastnames as (select * ,  row_number() over (order by last_name) as r_last from lastnames ),
          rank_cities as (select * ,  row_number() over (order by cityName) as r_city from cities ),
          rank_streets as (select * ,  row_number() over (order by street) as r_street from streets ),
          rank_states as (select * ,  row_number() over (order by state) as r_state from states )
         select
            m.member_id,
            f.first_name as first_name,
            l.last_name as last_name,
            concat (l.last_name, ', ',  f.first_name) as full_name,
            m.mbi,
            m.hicn,
            m.external_member_id,
            m.health_plan_member_id,
            st.street  as address_line_1,
            ''  as address_line_2,
            c.CityName   as City,
            s.State  as State
            From new_members m
            inner join  m_rank_index x on m.member_id = x.member_id
            inner join rank_firstnames f on x.f_index = f.r_first
            inner join rank_lastnames l on x.l_index = l.r_last
            inner join rank_streets st on x.st_index = st.r_street
            inner join rank_cities c on x.c_index = c.r_city
            inner join rank_states s on x.s_index = s.r_state

  new_anonymized_member_master:
    sql: >-
      select *
        from new_rows_anonymized_member_master
      union
      select *
        from  anonymized_member_master
    cache: true

  anonymized_members_incremental:
    sql: >-
      select
            a.hash_value,
            a.operation,
            a.job_id,
            a.load_year,
            a.load_month,
            a.member_id,
            b.hicn,
            b.mbi,
            b.external_member_id,
            b.full_name,
            b.first_name,
            b.last_name,
            a.gender,
            a.date_of_birth,
            a.age,
            b.health_plan_member_id,
            a.health_plan_name,
            b.address_line_1,
            b.address_line_2,
            b.city,
            a.zip,
            b.state,
            a.phone,
            a.program,
            a.pcp_id,
            a.chart_delivered_count,
            a.flex1,
            a.flex2,
            a.flex3,
            a.flex4,
            a.flex5,
            a.flex6,
            a.flex7,
            a.flex8,
            a.flex9,
            a.flex10
      from members_incremental a
      left join new_anonymized_member_master b on a.member_id = b.member_id

#2nd table that also include phi data
  member_index_incremental:
    sql: >-
      WITH new_rows as (
           SELECT
            a.hash_value,
            'INSERT' as operation,
            a.job_id,
            a.member_id,
            a.hicn,
            a.mbi,
            a.external_member_id,
            a.full_name,
            a.first_name,
            a.last_name,
            a.date_of_birth,
            a.age,
            a.gender,
            a.address_line_1,
            a.address_line_2,
            a.city,
            a.state,
            a.zip,
            a.phone,
            a.program,
            a.health_plan_member_id,
            a.health_plan_name,
            a.chart_delivered_count,
            a.flex1,
            a.flex2,
            a.flex3,
            a.flex4,
            a.flex5,
            a.flex6,
            a.flex7,
            a.flex8,
            a.flex9,
            a.flex10,
            a.pcp_provider_id,
            a.pcp_name,
            a.pcp_npi,
            a.pcp_tax_id,
            a.pcp_flex1,
            a.pcp_flex2,
            a.pcp_flex3,
            a.pcp_flex4,
            a.pcp_flex5,
            a.pcp_flex6,
            a.pcp_flex7,
            a.pcp_flex8,
            a.pcp_flex9,
            a.pcp_flex10,
            a.provider_info,
            a.last_encounter,
            a.pcp_last_encounter,
            a.spec_last_encounter,
            a.current_dos_count,
            a.current_pcp_dos_count,
            a.prior_dos_count,
            a.prior_pcp_dos_count,
            a.prior2_dos_count,
            a.prior2_pcp_dos_count,
            a.encountered_ids,
            a.current_mmr_esrd,
            a.prior_mmr_esrd,
            a.prior2_mmr_esrd,
            a.current_mmr_hospice,
            a.prior_mmr_hospice,
            a.prior2_mmr_hospice,
            a.current_mmr_risk_code_type,
            a.prior_mmr_risk_code_type,
            a.prior2_mmr_risk_code_type,
            a.current_mmr_risk_code_description,
            a.prior_mmr_risk_code_description,
            a.prior2_mmr_risk_code_description,
            a.current_is_eligible,
            a.prior_is_eligible,
            a.prior2_is_eligible,
            a.eligibility_date,
            a.eligibility_end_date,
            a.current_eligibility_status,
            a.prior_eligibility_status,
            a.prior2_eligibility_status,
            a.current_num_months_eligible,
            a.prior_num_months_eligible,
            a.prior2_num_months_eligible,
            a.current_recap_count,
            a.prior_recap_count,
            a.prior2_recap_count,
            a.current_recap_opp_count,
            a.prior_recap_opp_count,
            a.prior2_recap_opp_count,
            a.current_wellness_visit,
            a.prior_wellness_visit,
            a.prior2_wellness_visit,
            a.current_raf_captured,
            a.prior_raf_captured,
            a.prior2_raf_captured,
            a.current_raf_demo,
            a.prior_raf_demo,
            a.prior2_raf_demo,
            a.current_opportunity,
            a.prior_opportunity,
            a.prior2_opportunity,
            a.current_raf_projected,
            a.prior_raf_projected,
            a.prior2_raf_projected,
            a.current_hcc_cap,
            a.prior_hcc_cap,
            a.prior2_hcc_cap,
            a.current_hcc_sus,
            a.prior_hcc_sus,
            a.prior2_hcc_sus,
            a.current_hcc_captured,
            a.prior_hcc_captured,
            a.prior2_hcc_captured,
            a.current_hcc_captured_source_claim,
            a.prior_hcc_captured_source_claim,
            a.prior2_hcc_captured_source_claim,
            a.current_hcc_captured_source_hra,
            a.prior_hcc_captured_source_hra,
            a.prior2_hcc_captured_source_hra,
            a.current_hcc_captured_source_hra_crr,
            a.prior_hcc_captured_source_hra_crr,
            a.prior2_hcc_captured_source_hra_crr,
            a.current_hcc_captured_source_mor,
            a.prior_hcc_captured_source_mor,
            a.prior2_hcc_captured_source_mor,
            a.current_hcc_captured_source_crr,
            a.prior_hcc_captured_source_crr,
            a.prior2_hcc_captured_source_crr,
            a.current_hcc_captured_source_other,
            a.prior_hcc_captured_source_other,
            a.prior2_hcc_captured_source_other,
            a.current_hcc_captured_new_chronic,
            a.prior_hcc_captured_new_chronic,
            a.prior2_hcc_captured_new_chronic,
            a.current_hcc_captured_yoy_recapture,
            a.prior_hcc_captured_yoy_recapture,
            a.prior2_hcc_captured_yoy_recapture,
            a.current_hcc_captured_mor_new_chronic,
            a.prior_hcc_captured_mor_new_chronic,
            a.prior2_hcc_captured_mor_new_chronic,
            a.current_hcc_captured_mor_yoy_recapture,
            a.prior_hcc_captured_mor_yoy_recapture,
            a.prior2_hcc_captured_mor_yoy_recapture,
            a.current_hcc_captured_acute,
            a.prior_hcc_captured_acute,
            a.prior2_hcc_captured_acute,
            a.current_hcc_captured_other,
            a.prior_hcc_captured_other,
            a.prior2_hcc_captured_other,
            a.current_hcc_suspects_all,
            a.prior_hcc_suspects_all,
            a.prior2_hcc_suspects_all,
            a.current_hcc_suspects_yoy,
            a.prior_hcc_suspects_yoy,
            a.prior2_hcc_suspects_yoy,
            a.current_hcc_suspects_mor_yoy,
            a.prior_hcc_suspects_mor_yoy,
            a.prior2_hcc_suspects_mor_yoy,
            a.current_hcc_suspects_u,
            a.prior_hcc_suspects_u,
            a.prior2_hcc_suspects_u,
            a.current_hcc_suspects_asr,
            a.prior_hcc_suspects_asr,
            a.prior2_hcc_suspects_asr,
            a.current_hcc_suspects_n,
            a.prior_hcc_suspects_n,
            a.prior2_hcc_suspects_n,
            a.current_hcc_suspects_cpt,
            a.prior_hcc_suspects_cpt,
            a.prior2_hcc_suspects_cpt,
            a.current_hcc_suspects_ml,
            a.prior_hcc_suspects_ml,
            a.prior2_hcc_suspects_ml,
            a.current_hcc_suspects_other,
            a.prior_hcc_suspects_other,
            a.prior2_hcc_suspects_other,
            a.current_hcc_suspects_clinical,
            a.prior_hcc_suspects_clinical,
            a.prior2_hcc_suspects_clinical,
            a.current_hcc_captured_num_all,
            a.prior_hcc_captured_num_all,
            a.prior2_hcc_captured_num_all,
            a.current_hcc_captured_num_source_claim,
            a.prior_hcc_captured_num_source_claim,
            a.prior2_hcc_captured_num_source_claim,
            a.current_hcc_captured_num_source_hra,
            a.prior_hcc_captured_num_source_hra,
            a.prior2_hcc_captured_num_source_hra,
            a.current_hcc_captured_num_source_hra_crr,
            a.prior_hcc_captured_num_source_hra_crr,
            a.prior2_hcc_captured_num_source_hra_crr,
            a.current_hcc_captured_num_source_mor,
            a.prior_hcc_captured_num_source_mor,
            a.prior2_hcc_captured_num_source_mor,
            a.current_hcc_captured_num_source_crr,
            a.prior_hcc_captured_num_source_crr,
            a.prior2_hcc_captured_num_source_crr,
            a.current_hcc_captured_num_source_other,
            a.prior_hcc_captured_num_source_other,
            a.prior2_hcc_captured_num_source_other,
            a.current_hcc_captured_num_new_chronic,
            a.prior_hcc_captured_num_new_chronic,
            a.prior2_hcc_captured_num_new_chronic,
            a.current_hcc_captured_num_yoy_recapture,
            a.prior_hcc_captured_num_yoy_recapture,
            a.prior2_hcc_captured_num_yoy_recapture,
            a.current_hcc_captured_num_mor_new_chronic,
            a.prior_hcc_captured_num_mor_new_chronic,
            a.prior2_hcc_captured_num_mor_new_chronic,
            a.current_hcc_captured_num_mor_yoy_recapture,
            a.prior_hcc_captured_num_mor_yoy_recapture,
            a.prior2_hcc_captured_num_mor_yoy_recapture,
            a.current_hcc_captured_num_acute,
            a.prior_hcc_captured_num_acute,
            a.prior2_hcc_captured_num_acute,
            a.current_hcc_captured_num_other,
            a.prior_hcc_captured_num_other,
            a.prior2_hcc_captured_num_other,
            a.current_hcc_suspects_num_all,
            a.prior_hcc_suspects_num_all,
            a.prior2_hcc_suspects_num_all,
            a.current_hcc_suspects_num_yoy,
            a.prior_hcc_suspects_num_yoy,
            a.prior2_hcc_suspects_num_yoy,
            a.current_hcc_suspects_num_mor_yoy,
            a.prior_hcc_suspects_num_mor_yoy,
            a.prior2_hcc_suspects_num_mor_yoy,
            a.current_hcc_suspects_num_u,
            a.prior_hcc_suspects_num_u,
            a.prior2_hcc_suspects_num_u,
            a.current_hcc_suspects_num_asr,
            a.prior_hcc_suspects_num_asr,
            a.prior2_hcc_suspects_num_asr,
            a.current_hcc_suspects_num_n,
            a.prior_hcc_suspects_num_n,
            a.prior2_hcc_suspects_num_n,
            a.current_hcc_suspects_num_cpt,
            a.prior_hcc_suspects_num_cpt,
            a.prior2_hcc_suspects_num_cpt,
            a.current_hcc_suspects_num_ml,
            a.prior_hcc_suspects_num_ml,
            a.prior2_hcc_suspects_num_ml,
            a.current_hcc_suspects_num_other,
            a.prior_hcc_suspects_num_other,
            a.prior2_hcc_suspects_num_other,
            a.current_hcc_suspects_num_clinical,
            a.prior_hcc_suspects_num_clinical,
            a.prior2_hcc_suspects_num_clinical,
            a.current_raf_profitability,
            a.prior_raf_profitability,
            a.prior2_raf_profitability,
            a.current_dual,
            a.current_dual_opp,
            a.prior_dual,
            a.prior_dual_opp,
            a.prior2_dual,
            a.prior2_dual_opp,
            a.current_dual_opp_score,
            a.prior_dual_opp_score,
            a.prior2_dual_opp_score,
            a.current_raf_captured_cf,
            a.prior_raf_captured_cf,
            a.prior2_raf_captured_cf,
            a.current_raf_dual_boost,
            a.prior_raf_dual_boost,
            a.prior2_raf_dual_boost,
            a.current_cf_profitability,
            a.prior_cf_profitability,
            a.prior2_cf_profitability,
            a.current_parta_ramra_pa,
            a.prior_parta_ramra_pa,
            a.prior2_parta_ramra_pa,
            a.current_partb_ramra_pa,
            a.prior_partb_ramra_pa,
            a.prior2_partb_ramra_pa,
            a.current_hra_completed,
            a.prior_hra_completed,
            a.prior2_hra_completed
          FROM  member_index_full a
          LEFT JOIN  previous_load b on a.member_id = b.member_id
          WHERE b.member_id is null ),
      delete_rows as (
          SELECT
             a.hash_value,
             'DELETE' as operation,
              ( select cad_job_id from cad_job ) as job_id,
             a.member_id,
              cast( null as string ) as  hicn,
              cast( null as string ) as  mbi,
              cast( null as string ) as  external_member_id,
              cast( null as string ) as  full_name,
              cast( null as string ) as  first_name,
              cast( null as string ) as  last_name,
              cast( null as date ) as  date_of_birth,
              cast( null as integer ) as  age,
              cast( null as string ) as  gender,
              cast( null as string ) as  address_line_1,
              cast( null as string ) as  address_line_2,
              cast( null as string ) as  city,
              cast( null as string ) as  state,
              cast( null as string ) as  zip,
              cast( null as string ) as  phone,
              cast( null as string ) as  program,
              cast( null as string ) as  health_plan_member_id,
              cast( null as string ) as  health_plan_name,
              cast( null as integer ) as  chart_delivered_count,
              cast( null as string ) as  flex1,
              cast( null as string ) as  flex2,
              cast( null as string ) as  flex3,
              cast( null as string ) as  flex4,
              cast( null as string ) as  flex5,
              cast( null as string ) as  flex6,
              cast( null as string ) as  flex7,
              cast( null as string ) as  flex8,
              cast( null as string ) as  flex9,
              cast( null as string ) as  flex10,
              cast( null as string ) as  pcp_provider_id,
              cast( null as string ) as  pcp_name,
              cast( null as string ) as  pcp_npi,
              cast( null as string ) as  pcp_tax_id,
              cast( null as string ) as  pcp_flex1,
              cast( null as string ) as  pcp_flex2,
              cast( null as string ) as  pcp_flex3,
              cast( null as string ) as  pcp_flex4,
              cast( null as string ) as  pcp_flex5,
              cast( null as string ) as  pcp_flex6,
              cast( null as string ) as  pcp_flex7,
              cast( null as string ) as  pcp_flex8,
              cast( null as string ) as  pcp_flex9,
              cast( null as string ) as  pcp_flex10,
              cast( null as string  ) as  provider_info,
              cast( null as date ) as  last_encounter,
              cast( null as date ) as  pcp_last_encounter,
              cast( null as date ) as  spec_last_encounter,
              cast( null as integer ) as  current_dos_count,
              cast( null as integer ) as  current_pcp_dos_count,
              cast( null as integer ) as  prior_dos_count,
              cast( null as integer ) as  prior_pcp_dos_count,
              cast( null as integer ) as  prior2_dos_count,
              cast( null as integer ) as  prior2_pcp_dos_count,
              array(' ',' ') as  encountered_ids,
              cast( null as boolean ) as  current_mmr_esrd,
              cast( null as boolean ) as  prior_mmr_esrd,
              cast( null as boolean ) as  prior2_mmr_esrd,
              cast( null as boolean ) as  current_mmr_hospice,
              cast( null as boolean ) as  prior_mmr_hospice,
              cast( null as boolean ) as  prior2_mmr_hospice,
              cast( null as string ) as  current_mmr_risk_code_type,
              cast( null as string ) as  prior_mmr_risk_code_type,
              cast( null as string ) as  prior2_mmr_risk_code_type,
              cast( null as string ) as  current_mmr_risk_code_description,
              cast( null as string ) as  prior_mmr_risk_code_description,
              cast( null as string ) as  prior2_mmr_risk_code_description,
              cast( null as boolean ) as  current_is_eligible,
              cast( null as boolean ) as  prior_is_eligible,
              cast( null as boolean ) as  prior2_is_eligible,
              cast( null as date ) as  eligibility_date,
              cast( null as date ) as  eligibility_end_date,
              cast( null as string ) as  current_eligibility_status,
              cast( null as string ) as  prior_eligibility_status,
              cast( null as string ) as  prior2_eligibility_status,
              cast( null as integer ) as  current_num_months_eligible,
              cast( null as integer ) as  prior_num_months_eligible,
              cast( null as integer ) as  prior2_num_months_eligible,
              cast( null as integer ) as  current_recap_count,
              cast( null as integer ) as  prior_recap_count,
              cast( null as integer ) as  prior2_recap_count,
              cast( null as integer ) as  current_recap_opp_count,
              cast( null as integer ) as  prior_recap_opp_count,
              cast( null as integer ) as  prior2_recap_opp_count,
              cast( null as boolean ) as  current_wellness_visit,
              cast( null as boolean ) as  prior_wellness_visit,
              cast( null as boolean ) as  prior2_wellness_visit,
              cast( null as double ) as  current_raf_captured,
              cast( null as double ) as  prior_raf_captured,
              cast( null as double ) as  prior2_raf_captured,
              cast( null as double ) as  current_raf_demo,
              cast( null as double ) as  prior_raf_demo,
              cast( null as double ) as  prior2_raf_demo,
              cast( null as double ) as  current_opportunity,
              cast( null as double ) as  prior_opportunity,
              cast( null as double ) as  prior2_opportunity,
              cast( null as double ) as  current_raf_projected,
              cast( null as double ) as  prior_raf_projected,
              cast( null as double ) as  prior2_raf_projected,
              array(' ',' ')  as  current_hcc_cap,
              array(' ',' ')  as  prior_hcc_cap,
              array(' ',' ')  as  prior2_hcc_cap,
              array(' ',' ')  as  current_hcc_sus,
              array(' ',' ')  as  prior_hcc_sus,
              array(' ',' ')  as  prior2_hcc_sus,
              cast( null as double ) as  current_hcc_captured,
              cast( null as double ) as  prior_hcc_captured,
              cast( null as double ) as  prior2_hcc_captured,
              cast( null as double ) as  current_hcc_captured_source_claim,
              cast( null as double ) as  prior_hcc_captured_source_claim,
              cast( null as double ) as  prior2_hcc_captured_source_claim,
              cast( null as double ) as  current_hcc_captured_source_hra,
              cast( null as double ) as  prior_hcc_captured_source_hra,
              cast( null as double ) as  prior2_hcc_captured_source_hra,
              cast( null as double ) as  current_hcc_captured_source_hra_crr,
              cast( null as double ) as  prior_hcc_captured_source_hra_crr,
              cast( null as double ) as  prior2_hcc_captured_source_hra_crr,
              cast( null as double ) as  current_hcc_captured_source_mor,
              cast( null as double ) as  prior_hcc_captured_source_mor,
              cast( null as double ) as  prior2_hcc_captured_source_mor,
              cast( null as double ) as  current_hcc_captured_source_crr,
              cast( null as double ) as  prior_hcc_captured_source_crr,
              cast( null as double ) as  prior2_hcc_captured_source_crr,
              cast( null as double ) as  current_hcc_captured_source_other,
              cast( null as double ) as  prior_hcc_captured_source_other,
              cast( null as double ) as  prior2_hcc_captured_source_other,
              cast( null as double ) as  current_hcc_captured_new_chronic,
              cast( null as double ) as  prior_hcc_captured_new_chronic,
              cast( null as double ) as  prior2_hcc_captured_new_chronic,
              cast( null as double ) as  current_hcc_captured_yoy_recapture,
              cast( null as double ) as  prior_hcc_captured_yoy_recapture,
              cast( null as double ) as  prior2_hcc_captured_yoy_recapture,
              cast( null as double ) as  current_hcc_captured_mor_new_chronic,
              cast( null as double ) as  prior_hcc_captured_mor_new_chronic,
              cast( null as double ) as  prior2_hcc_captured_mor_new_chronic,
              cast( null as double ) as  current_hcc_captured_mor_yoy_recapture,
              cast( null as double ) as  prior_hcc_captured_mor_yoy_recapture,
              cast( null as double ) as  prior2_hcc_captured_mor_yoy_recapture,
              cast( null as double ) as  current_hcc_captured_acute,
              cast( null as double ) as  prior_hcc_captured_acute,
              cast( null as double ) as  prior2_hcc_captured_acute,
              cast( null as double ) as  current_hcc_captured_other,
              cast( null as double ) as  prior_hcc_captured_other,
              cast( null as double ) as  prior2_hcc_captured_other,
              cast( null as double ) as  current_hcc_suspects_all,
              cast( null as double ) as  prior_hcc_suspects_all,
              cast( null as double ) as  prior2_hcc_suspects_all,
              cast( null as double ) as  current_hcc_suspects_yoy,
              cast( null as double ) as  prior_hcc_suspects_yoy,
              cast( null as double ) as  prior2_hcc_suspects_yoy,
              cast( null as double ) as  current_hcc_suspects_mor_yoy,
              cast( null as double ) as  prior_hcc_suspects_mor_yoy,
              cast( null as double ) as  prior2_hcc_suspects_mor_yoy,
              cast( null as double ) as  current_hcc_suspects_u,
              cast( null as double ) as  prior_hcc_suspects_u,
              cast( null as double ) as  prior2_hcc_suspects_u,
              cast( null as double ) as  current_hcc_suspects_asr,
              cast( null as double ) as  prior_hcc_suspects_asr,
              cast( null as double ) as  prior2_hcc_suspects_asr,
              cast( null as double ) as  current_hcc_suspects_n,
              cast( null as double ) as  prior_hcc_suspects_n,
              cast( null as double ) as  prior2_hcc_suspects_n,
              cast( null as double ) as  current_hcc_suspects_cpt,
              cast( null as double ) as  prior_hcc_suspects_cpt,
              cast( null as double ) as  prior2_hcc_suspects_cpt,
              cast( null as double ) as  current_hcc_suspects_ml,
              cast( null as double ) as  prior_hcc_suspects_ml,
              cast( null as double ) as  prior2_hcc_suspects_ml,
              cast( null as double ) as  current_hcc_suspects_other,
              cast( null as double ) as  prior_hcc_suspects_other,
              cast( null as double ) as  prior2_hcc_suspects_other,
              cast( null as double ) as  current_hcc_suspects_clinical,
              cast( null as double ) as  prior_hcc_suspects_clinical,
              cast( null as double ) as  prior2_hcc_suspects_clinical,
              cast( null as integer ) as  current_hcc_captured_num_all,
              cast( null as integer ) as  prior_hcc_captured_num_all,
              cast( null as integer ) as  prior2_hcc_captured_num_all,
              cast( null as integer ) as  current_hcc_captured_num_source_claim,
              cast( null as integer ) as  prior_hcc_captured_num_source_claim,
              cast( null as integer ) as  prior2_hcc_captured_num_source_claim,
              cast( null as integer ) as  current_hcc_captured_num_source_hra,
              cast( null as integer ) as  prior_hcc_captured_num_source_hra,
              cast( null as integer ) as  prior2_hcc_captured_num_source_hra,
              cast( null as integer ) as  current_hcc_captured_num_source_hra_crr,
              cast( null as integer ) as  prior_hcc_captured_num_source_hra_crr,
              cast( null as integer ) as  prior2_hcc_captured_num_source_hra_crr,
              cast( null as integer ) as  current_hcc_captured_num_source_mor,
              cast( null as integer ) as  prior_hcc_captured_num_source_mor,
              cast( null as integer ) as  prior2_hcc_captured_num_source_mor,
              cast( null as integer ) as  current_hcc_captured_num_source_crr,
              cast( null as integer ) as  prior_hcc_captured_num_source_crr,
              cast( null as integer ) as  prior2_hcc_captured_num_source_crr,
              cast( null as integer ) as  current_hcc_captured_num_source_other,
              cast( null as integer ) as  prior_hcc_captured_num_source_other,
              cast( null as integer ) as  prior2_hcc_captured_num_source_other,
              cast( null as integer ) as  current_hcc_captured_num_new_chronic,
              cast( null as integer ) as  prior_hcc_captured_num_new_chronic,
              cast( null as integer ) as  prior2_hcc_captured_num_new_chronic,
              cast( null as integer ) as  current_hcc_captured_num_yoy_recapture,
              cast( null as integer ) as  prior_hcc_captured_num_yoy_recapture,
              cast( null as integer ) as  prior2_hcc_captured_num_yoy_recapture,
              cast( null as integer ) as  current_hcc_captured_num_mor_new_chronic,
              cast( null as integer ) as  prior_hcc_captured_num_mor_new_chronic,
              cast( null as integer ) as  prior2_hcc_captured_num_mor_new_chronic,
              cast( null as integer ) as  current_hcc_captured_num_mor_yoy_recapture,
              cast( null as integer ) as  prior_hcc_captured_num_mor_yoy_recapture,
              cast( null as integer ) as  prior2_hcc_captured_num_mor_yoy_recapture,
              cast( null as integer ) as  current_hcc_captured_num_acute,
              cast( null as integer ) as  prior_hcc_captured_num_acute,
              cast( null as integer ) as  prior2_hcc_captured_num_acute,
              cast( null as integer ) as  current_hcc_captured_num_other,
              cast( null as integer ) as  prior_hcc_captured_num_other,
              cast( null as integer ) as  prior2_hcc_captured_num_other,
              cast( null as integer ) as  current_hcc_suspects_num_all,
              cast( null as integer ) as  prior_hcc_suspects_num_all,
              cast( null as integer ) as  prior2_hcc_suspects_num_all,
              cast( null as integer ) as  current_hcc_suspects_num_yoy,
              cast( null as integer ) as  prior_hcc_suspects_num_yoy,
              cast( null as integer ) as  prior2_hcc_suspects_num_yoy,
              cast( null as integer ) as  current_hcc_suspects_num_mor_yoy,
              cast( null as integer ) as  prior_hcc_suspects_num_mor_yoy,
              cast( null as integer ) as  prior2_hcc_suspects_num_mor_yoy,
              cast( null as integer ) as  current_hcc_suspects_num_u,
              cast( null as integer ) as  prior_hcc_suspects_num_u,
              cast( null as integer ) as  prior2_hcc_suspects_num_u,
              cast( null as integer ) as  current_hcc_suspects_num_asr,
              cast( null as integer ) as  prior_hcc_suspects_num_asr,
              cast( null as integer ) as  prior2_hcc_suspects_num_asr,
              cast( null as integer ) as  current_hcc_suspects_num_n,
              cast( null as integer ) as  prior_hcc_suspects_num_n,
              cast( null as integer ) as  prior2_hcc_suspects_num_n,
              cast( null as integer ) as  current_hcc_suspects_num_cpt,
              cast( null as integer ) as  prior_hcc_suspects_num_cpt,
              cast( null as integer ) as  prior2_hcc_suspects_num_cpt,
              cast( null as integer ) as  current_hcc_suspects_num_ml,
              cast( null as integer ) as  prior_hcc_suspects_num_ml,
              cast( null as integer ) as  prior2_hcc_suspects_num_ml,
              cast( null as integer ) as  current_hcc_suspects_num_other,
              cast( null as integer ) as  prior_hcc_suspects_num_other,
              cast( null as integer ) as  prior2_hcc_suspects_num_other,
              cast( null as integer ) as  current_hcc_suspects_num_clinical,
              cast( null as integer ) as  prior_hcc_suspects_num_clinical,
              cast( null as integer ) as  prior2_hcc_suspects_num_clinical,
              cast( null as double ) as  current_raf_profitability,
              cast( null as double ) as  prior_raf_profitability,
              cast( null as double ) as  prior2_raf_profitability,
              cast( null as boolean ) as  current_dual,
              cast( null as boolean ) as  current_dual_opp,
              cast( null as boolean ) as  prior_dual,
              cast( null as boolean ) as  prior_dual_opp,
              cast( null as boolean ) as  prior2_dual,
              cast( null as boolean ) as  prior2_dual_opp,
              cast( null as double ) as  current_dual_opp_score,
              cast( null as double ) as  prior_dual_opp_score,
              cast( null as double ) as  prior2_dual_opp_score,
              cast( null as double ) as  current_raf_captured_cf,
              cast( null as double ) as  prior_raf_captured_cf,
              cast( null as double ) as  prior2_raf_captured_cf,
              cast( null as double ) as  current_raf_dual_boost,
              cast( null as double ) as  prior_raf_dual_boost,
              cast( null as double ) as  prior2_raf_dual_boost,
              cast( null as double ) as  current_cf_profitability,
              cast( null as double ) as  prior_cf_profitability,
              cast( null as double ) as  prior2_cf_profitability,
              cast( null as double ) as  current_parta_ramra_pa,
              cast( null as double ) as  prior_parta_ramra_pa,
              cast( null as double ) as  prior2_parta_ramra_pa,
              cast( null as double ) as  current_partb_ramra_pa,
              cast( null as double ) as  prior_partb_ramra_pa,
              cast( null as double ) as  prior2_partb_ramra_pa,
              cast( null as boolean ) as  current_hra_completed,
              cast( null as boolean ) as  prior_hra_completed,
              cast( null as boolean ) as  prior2_hra_completed
          FROM  previous_load a
          LEFT JOIN  member_index_full  b on a.member_id = b.member_id
          WHERE b.member_id is null ),
      update_rows as (
          SELECT
             a.hash_value,
             'UPDATE' as operation,
             a.job_id,
              a.member_id,
              a.hicn,
              a.mbi,
              a.external_member_id,
              a.full_name,
              a.first_name,
              a.last_name,
              a.date_of_birth,
              a.age,
              a.gender,
              a.address_line_1,
              a.address_line_2,
              a.city,
              a.state,
              a.zip,
              a.phone,
              a.program,
              a.health_plan_member_id,
              a.health_plan_name,
              a.chart_delivered_count,
              a.flex1,
              a.flex2,
              a.flex3,
              a.flex4,
              a.flex5,
              a.flex6,
              a.flex7,
              a.flex8,
              a.flex9,
              a.flex10,
              a.pcp_provider_id,
              a.pcp_name,
              a.pcp_npi,
              a.pcp_tax_id,
              a.pcp_flex1,
              a.pcp_flex2,
              a.pcp_flex3,
              a.pcp_flex4,
              a.pcp_flex5,
              a.pcp_flex6,
              a.pcp_flex7,
              a.pcp_flex8,
              a.pcp_flex9,
              a.pcp_flex10,
              a.provider_info,
              a.last_encounter,
              a.pcp_last_encounter,
              a.spec_last_encounter,
              a.current_dos_count,
              a.current_pcp_dos_count,
              a.prior_dos_count,
              a.prior_pcp_dos_count,
              a.prior2_dos_count,
              a.prior2_pcp_dos_count,
              a.encountered_ids,
              a.current_mmr_esrd,
              a.prior_mmr_esrd,
              a.prior2_mmr_esrd,
              a.current_mmr_hospice,
              a.prior_mmr_hospice,
              a.prior2_mmr_hospice,
              a.current_mmr_risk_code_type,
              a.prior_mmr_risk_code_type,
              a.prior2_mmr_risk_code_type,
              a.current_mmr_risk_code_description,
              a.prior_mmr_risk_code_description,
              a.prior2_mmr_risk_code_description,
              a.current_is_eligible,
              a.prior_is_eligible,
              a.prior2_is_eligible,
              a.eligibility_date,
              a.eligibility_end_date,
              a.current_eligibility_status,
              a.prior_eligibility_status,
              a.prior2_eligibility_status,
              a.current_num_months_eligible,
              a.prior_num_months_eligible,
              a.prior2_num_months_eligible,
              a.current_recap_count,
              a.prior_recap_count,
              a.prior2_recap_count,
              a.current_recap_opp_count,
              a.prior_recap_opp_count,
              a.prior2_recap_opp_count,
              a.current_wellness_visit,
              a.prior_wellness_visit,
              a.prior2_wellness_visit,
              a.current_raf_captured,
              a.prior_raf_captured,
              a.prior2_raf_captured,
              a.current_raf_demo,
              a.prior_raf_demo,
              a.prior2_raf_demo,
              a.current_opportunity,
              a.prior_opportunity,
              a.prior2_opportunity,
              a.current_raf_projected,
              a.prior_raf_projected,
              a.prior2_raf_projected,
              a.current_hcc_cap,
              a.prior_hcc_cap,
              a.prior2_hcc_cap,
              a.current_hcc_sus,
              a.prior_hcc_sus,
              a.prior2_hcc_sus,
              a.current_hcc_captured,
              a.prior_hcc_captured,
              a.prior2_hcc_captured,
              a.current_hcc_captured_source_claim,
              a.prior_hcc_captured_source_claim,
              a.prior2_hcc_captured_source_claim,
              a.current_hcc_captured_source_hra,
              a.prior_hcc_captured_source_hra,
              a.prior2_hcc_captured_source_hra,
              a.current_hcc_captured_source_hra_crr,
              a.prior_hcc_captured_source_hra_crr,
              a.prior2_hcc_captured_source_hra_crr,
              a.current_hcc_captured_source_mor,
              a.prior_hcc_captured_source_mor,
              a.prior2_hcc_captured_source_mor,
              a.current_hcc_captured_source_crr,
              a.prior_hcc_captured_source_crr,
              a.prior2_hcc_captured_source_crr,
              a.current_hcc_captured_source_other,
              a.prior_hcc_captured_source_other,
              a.prior2_hcc_captured_source_other,
              a.current_hcc_captured_new_chronic,
              a.prior_hcc_captured_new_chronic,
              a.prior2_hcc_captured_new_chronic,
              a.current_hcc_captured_yoy_recapture,
              a.prior_hcc_captured_yoy_recapture,
              a.prior2_hcc_captured_yoy_recapture,
              a.current_hcc_captured_mor_new_chronic,
              a.prior_hcc_captured_mor_new_chronic,
              a.prior2_hcc_captured_mor_new_chronic,
              a.current_hcc_captured_mor_yoy_recapture,
              a.prior_hcc_captured_mor_yoy_recapture,
              a.prior2_hcc_captured_mor_yoy_recapture,
              a.current_hcc_captured_acute,
              a.prior_hcc_captured_acute,
              a.prior2_hcc_captured_acute,
              a.current_hcc_captured_other,
              a.prior_hcc_captured_other,
              a.prior2_hcc_captured_other,
              a.current_hcc_suspects_all,
              a.prior_hcc_suspects_all,
              a.prior2_hcc_suspects_all,
              a.current_hcc_suspects_yoy,
              a.prior_hcc_suspects_yoy,
              a.prior2_hcc_suspects_yoy,
              a.current_hcc_suspects_mor_yoy,
              a.prior_hcc_suspects_mor_yoy,
              a.prior2_hcc_suspects_mor_yoy,
              a.current_hcc_suspects_u,
              a.prior_hcc_suspects_u,
              a.prior2_hcc_suspects_u,
              a.current_hcc_suspects_asr,
              a.prior_hcc_suspects_asr,
              a.prior2_hcc_suspects_asr,
              a.current_hcc_suspects_n,
              a.prior_hcc_suspects_n,
              a.prior2_hcc_suspects_n,
              a.current_hcc_suspects_cpt,
              a.prior_hcc_suspects_cpt,
              a.prior2_hcc_suspects_cpt,
              a.current_hcc_suspects_ml,
              a.prior_hcc_suspects_ml,
              a.prior2_hcc_suspects_ml,
              a.current_hcc_suspects_other,
              a.prior_hcc_suspects_other,
              a.prior2_hcc_suspects_other,
              a.current_hcc_suspects_clinical,
              a.prior_hcc_suspects_clinical,
              a.prior2_hcc_suspects_clinical,
              a.current_hcc_captured_num_all,
              a.prior_hcc_captured_num_all,
              a.prior2_hcc_captured_num_all,
              a.current_hcc_captured_num_source_claim,
              a.prior_hcc_captured_num_source_claim,
              a.prior2_hcc_captured_num_source_claim,
              a.current_hcc_captured_num_source_hra,
              a.prior_hcc_captured_num_source_hra,
              a.prior2_hcc_captured_num_source_hra,
              a.current_hcc_captured_num_source_hra_crr,
              a.prior_hcc_captured_num_source_hra_crr,
              a.prior2_hcc_captured_num_source_hra_crr,
              a.current_hcc_captured_num_source_mor,
              a.prior_hcc_captured_num_source_mor,
              a.prior2_hcc_captured_num_source_mor,
              a.current_hcc_captured_num_source_crr,
              a.prior_hcc_captured_num_source_crr,
              a.prior2_hcc_captured_num_source_crr,
              a.current_hcc_captured_num_source_other,
              a.prior_hcc_captured_num_source_other,
              a.prior2_hcc_captured_num_source_other,
              a.current_hcc_captured_num_new_chronic,
              a.prior_hcc_captured_num_new_chronic,
              a.prior2_hcc_captured_num_new_chronic,
              a.current_hcc_captured_num_yoy_recapture,
              a.prior_hcc_captured_num_yoy_recapture,
              a.prior2_hcc_captured_num_yoy_recapture,
              a.current_hcc_captured_num_mor_new_chronic,
              a.prior_hcc_captured_num_mor_new_chronic,
              a.prior2_hcc_captured_num_mor_new_chronic,
              a.current_hcc_captured_num_mor_yoy_recapture,
              a.prior_hcc_captured_num_mor_yoy_recapture,
              a.prior2_hcc_captured_num_mor_yoy_recapture,
              a.current_hcc_captured_num_acute,
              a.prior_hcc_captured_num_acute,
              a.prior2_hcc_captured_num_acute,
              a.current_hcc_captured_num_other,
              a.prior_hcc_captured_num_other,
              a.prior2_hcc_captured_num_other,
              a.current_hcc_suspects_num_all,
              a.prior_hcc_suspects_num_all,
              a.prior2_hcc_suspects_num_all,
              a.current_hcc_suspects_num_yoy,
              a.prior_hcc_suspects_num_yoy,
              a.prior2_hcc_suspects_num_yoy,
              a.current_hcc_suspects_num_mor_yoy,
              a.prior_hcc_suspects_num_mor_yoy,
              a.prior2_hcc_suspects_num_mor_yoy,
              a.current_hcc_suspects_num_u,
              a.prior_hcc_suspects_num_u,
              a.prior2_hcc_suspects_num_u,
              a.current_hcc_suspects_num_asr,
              a.prior_hcc_suspects_num_asr,
              a.prior2_hcc_suspects_num_asr,
              a.current_hcc_suspects_num_n,
              a.prior_hcc_suspects_num_n,
              a.prior2_hcc_suspects_num_n,
              a.current_hcc_suspects_num_cpt,
              a.prior_hcc_suspects_num_cpt,
              a.prior2_hcc_suspects_num_cpt,
              a.current_hcc_suspects_num_ml,
              a.prior_hcc_suspects_num_ml,
              a.prior2_hcc_suspects_num_ml,
              a.current_hcc_suspects_num_other,
              a.prior_hcc_suspects_num_other,
              a.prior2_hcc_suspects_num_other,
              a.current_hcc_suspects_num_clinical,
              a.prior_hcc_suspects_num_clinical,
              a.prior2_hcc_suspects_num_clinical,
              a.current_raf_profitability,
              a.prior_raf_profitability,
              a.prior2_raf_profitability,
              a.current_dual,
              a.current_dual_opp,
              a.prior_dual,
              a.prior_dual_opp,
              a.prior2_dual,
              a.prior2_dual_opp,
              a.current_dual_opp_score,
              a.prior_dual_opp_score,
              a.prior2_dual_opp_score,
              a.current_raf_captured_cf,
              a.prior_raf_captured_cf,
              a.prior2_raf_captured_cf,
              a.current_raf_dual_boost,
              a.prior_raf_dual_boost,
              a.prior2_raf_dual_boost,
              a.current_cf_profitability,
              a.prior_cf_profitability,
              a.prior2_cf_profitability,
              a.current_parta_ramra_pa,
              a.prior_parta_ramra_pa,
              a.prior2_parta_ramra_pa,
              a.current_partb_ramra_pa,
              a.prior_partb_ramra_pa,
              a.prior2_partb_ramra_pa,
              a.current_hra_completed,
              a.prior_hra_completed,
              a.prior2_hra_completed
           FROM   member_index_full  a
           INNER JOIN previous_load b on a.member_id = b.member_id
           WHERE a.hash_value <> b.hash_value )
      SELECT *
      FROM new_rows
      UNION
      SELECT *
      FROM delete_rows
      UNION
      SELECT *
      FROM update_rows

  anonymized_member_index_incremental:
    sql: >-
      SELECT
            a.hash_value,
            a.operation,
            a.job_id,
            a.member_id,
            b.hicn,
            b.mbi,
            b.external_member_id,
            b.full_name,
            b.first_name,
            b.last_name,
            a.date_of_birth,
            a.age,
            a.gender,
            b.address_line_1,
            b.address_line_2,
            b.city,
            b.state,
            a.zip,
            a.phone,
            a.program,
            b.health_plan_member_id,
            a.health_plan_name,
            a.chart_delivered_count,
            a.flex1,
            a.flex2,
            a.flex3,
            a.flex4,
            a.flex5,
            a.flex6,
            a.flex7,
            a.flex8,
            a.flex9,
            a.flex10,
            a.pcp_provider_id,
            a.pcp_name,
            a.pcp_npi,
            a.pcp_tax_id,
            a.pcp_flex1,
            a.pcp_flex2,
            a.pcp_flex3,
            a.pcp_flex4,
            a.pcp_flex5,
            a.pcp_flex6,
            a.pcp_flex7,
            a.pcp_flex8,
            a.pcp_flex9,
            a.pcp_flex10,
            a.provider_info,
            a.last_encounter,
            a.pcp_last_encounter,
            a.spec_last_encounter,
            a.current_dos_count,
            a.current_pcp_dos_count,
            a.prior_dos_count,
            a.prior_pcp_dos_count,
            a.prior2_dos_count,
            a.prior2_pcp_dos_count,
            a.encountered_ids,
            a.current_mmr_esrd,
            a.prior_mmr_esrd,
            a.prior2_mmr_esrd,
            a.current_mmr_hospice,
            a.prior_mmr_hospice,
            a.prior2_mmr_hospice,
            a.current_mmr_risk_code_type,
            a.prior_mmr_risk_code_type,
            a.prior2_mmr_risk_code_type,
            a.current_mmr_risk_code_description,
            a.prior_mmr_risk_code_description,
            a.prior2_mmr_risk_code_description,
            a.current_is_eligible,
            a.prior_is_eligible,
            a.prior2_is_eligible,
            a.eligibility_date,
            a.eligibility_end_date,
            a.current_eligibility_status,
            a.prior_eligibility_status,
            a.prior2_eligibility_status,
            a.current_num_months_eligible,
            a.prior_num_months_eligible,
            a.prior2_num_months_eligible,
            a.current_recap_count,
            a.prior_recap_count,
            a.prior2_recap_count,
            a.current_recap_opp_count,
            a.prior_recap_opp_count,
            a.prior2_recap_opp_count,
            a.current_wellness_visit,
            a.prior_wellness_visit,
            a.prior2_wellness_visit,
            a.current_raf_captured,
            a.prior_raf_captured,
            a.prior2_raf_captured,
            a.current_raf_demo,
            a.prior_raf_demo,
            a.prior2_raf_demo,
            a.current_opportunity,
            a.prior_opportunity,
            a.prior2_opportunity,
            a.current_raf_projected,
            a.prior_raf_projected,
            a.prior2_raf_projected,
            a.current_hcc_cap,
            a.prior_hcc_cap,
            a.prior2_hcc_cap,
            a.current_hcc_sus,
            a.prior_hcc_sus,
            a.prior2_hcc_sus,
            a.current_hcc_captured,
            a.prior_hcc_captured,
            a.prior2_hcc_captured,
            a.current_hcc_captured_source_claim,
            a.prior_hcc_captured_source_claim,
            a.prior2_hcc_captured_source_claim,
            a.current_hcc_captured_source_hra,
            a.prior_hcc_captured_source_hra,
            a.prior2_hcc_captured_source_hra,
            a.current_hcc_captured_source_hra_crr,
            a.prior_hcc_captured_source_hra_crr,
            a.prior2_hcc_captured_source_hra_crr,
            a.current_hcc_captured_source_mor,
            a.prior_hcc_captured_source_mor,
            a.prior2_hcc_captured_source_mor,
            a.current_hcc_captured_source_crr,
            a.prior_hcc_captured_source_crr,
            a.prior2_hcc_captured_source_crr,
            a.current_hcc_captured_source_other,
            a.prior_hcc_captured_source_other,
            a.prior2_hcc_captured_source_other,
            a.current_hcc_captured_new_chronic,
            a.prior_hcc_captured_new_chronic,
            a.prior2_hcc_captured_new_chronic,
            a.current_hcc_captured_yoy_recapture,
            a.prior_hcc_captured_yoy_recapture,
            a.prior2_hcc_captured_yoy_recapture,
            a.current_hcc_captured_mor_new_chronic,
            a.prior_hcc_captured_mor_new_chronic,
            a.prior2_hcc_captured_mor_new_chronic,
            a.current_hcc_captured_mor_yoy_recapture,
            a.prior_hcc_captured_mor_yoy_recapture,
            a.prior2_hcc_captured_mor_yoy_recapture,
            a.current_hcc_captured_acute,
            a.prior_hcc_captured_acute,
            a.prior2_hcc_captured_acute,
            a.current_hcc_captured_other,
            a.prior_hcc_captured_other,
            a.prior2_hcc_captured_other,
            a.current_hcc_suspects_all,
            a.prior_hcc_suspects_all,
            a.prior2_hcc_suspects_all,
            a.current_hcc_suspects_yoy,
            a.prior_hcc_suspects_yoy,
            a.prior2_hcc_suspects_yoy,
            a.current_hcc_suspects_mor_yoy,
            a.prior_hcc_suspects_mor_yoy,
            a.prior2_hcc_suspects_mor_yoy,
            a.current_hcc_suspects_u,
            a.prior_hcc_suspects_u,
            a.prior2_hcc_suspects_u,
            a.current_hcc_suspects_asr,
            a.prior_hcc_suspects_asr,
            a.prior2_hcc_suspects_asr,
            a.current_hcc_suspects_n,
            a.prior_hcc_suspects_n,
            a.prior2_hcc_suspects_n,
            a.current_hcc_suspects_cpt,
            a.prior_hcc_suspects_cpt,
            a.prior2_hcc_suspects_cpt,
            a.current_hcc_suspects_ml,
            a.prior_hcc_suspects_ml,
            a.prior2_hcc_suspects_ml,
            a.current_hcc_suspects_other,
            a.prior_hcc_suspects_other,
            a.prior2_hcc_suspects_other,
            a.current_hcc_suspects_clinical,
            a.prior_hcc_suspects_clinical,
            a.prior2_hcc_suspects_clinical,
            a.current_hcc_captured_num_all,
            a.prior_hcc_captured_num_all,
            a.prior2_hcc_captured_num_all,
            a.current_hcc_captured_num_source_claim,
            a.prior_hcc_captured_num_source_claim,
            a.prior2_hcc_captured_num_source_claim,
            a.current_hcc_captured_num_source_hra,
            a.prior_hcc_captured_num_source_hra,
            a.prior2_hcc_captured_num_source_hra,
            a.current_hcc_captured_num_source_hra_crr,
            a.prior_hcc_captured_num_source_hra_crr,
            a.prior2_hcc_captured_num_source_hra_crr,
            a.current_hcc_captured_num_source_mor,
            a.prior_hcc_captured_num_source_mor,
            a.prior2_hcc_captured_num_source_mor,
            a.current_hcc_captured_num_source_crr,
            a.prior_hcc_captured_num_source_crr,
            a.prior2_hcc_captured_num_source_crr,
            a.current_hcc_captured_num_source_other,
            a.prior_hcc_captured_num_source_other,
            a.prior2_hcc_captured_num_source_other,
            a.current_hcc_captured_num_new_chronic,
            a.prior_hcc_captured_num_new_chronic,
            a.prior2_hcc_captured_num_new_chronic,
            a.current_hcc_captured_num_yoy_recapture,
            a.prior_hcc_captured_num_yoy_recapture,
            a.prior2_hcc_captured_num_yoy_recapture,
            a.current_hcc_captured_num_mor_new_chronic,
            a.prior_hcc_captured_num_mor_new_chronic,
            a.prior2_hcc_captured_num_mor_new_chronic,
            a.current_hcc_captured_num_mor_yoy_recapture,
            a.prior_hcc_captured_num_mor_yoy_recapture,
            a.prior2_hcc_captured_num_mor_yoy_recapture,
            a.current_hcc_captured_num_acute,
            a.prior_hcc_captured_num_acute,
            a.prior2_hcc_captured_num_acute,
            a.current_hcc_captured_num_other,
            a.prior_hcc_captured_num_other,
            a.prior2_hcc_captured_num_other,
            a.current_hcc_suspects_num_all,
            a.prior_hcc_suspects_num_all,
            a.prior2_hcc_suspects_num_all,
            a.current_hcc_suspects_num_yoy,
            a.prior_hcc_suspects_num_yoy,
            a.prior2_hcc_suspects_num_yoy,
            a.current_hcc_suspects_num_mor_yoy,
            a.prior_hcc_suspects_num_mor_yoy,
            a.prior2_hcc_suspects_num_mor_yoy,
            a.current_hcc_suspects_num_u,
            a.prior_hcc_suspects_num_u,
            a.prior2_hcc_suspects_num_u,
            a.current_hcc_suspects_num_asr,
            a.prior_hcc_suspects_num_asr,
            a.prior2_hcc_suspects_num_asr,
            a.current_hcc_suspects_num_n,
            a.prior_hcc_suspects_num_n,
            a.prior2_hcc_suspects_num_n,
            a.current_hcc_suspects_num_cpt,
            a.prior_hcc_suspects_num_cpt,
            a.prior2_hcc_suspects_num_cpt,
            a.current_hcc_suspects_num_ml,
            a.prior_hcc_suspects_num_ml,
            a.prior2_hcc_suspects_num_ml,
            a.current_hcc_suspects_num_other,
            a.prior_hcc_suspects_num_other,
            a.prior2_hcc_suspects_num_other,
            a.current_hcc_suspects_num_clinical,
            a.prior_hcc_suspects_num_clinical,
            a.prior2_hcc_suspects_num_clinical,
            a.current_raf_profitability,
            a.prior_raf_profitability,
            a.prior2_raf_profitability,
            a.current_dual,
            a.current_dual_opp,
            a.prior_dual,
            a.prior_dual_opp,
            a.prior2_dual,
            a.prior2_dual_opp,
            a.current_dual_opp_score,
            a.prior_dual_opp_score,
            a.prior2_dual_opp_score,
            a.current_raf_captured_cf,
            a.prior_raf_captured_cf,
            a.prior2_raf_captured_cf,
            a.current_raf_dual_boost,
            a.prior_raf_dual_boost,
            a.prior2_raf_dual_boost,
            a.current_cf_profitability,
            a.prior_cf_profitability,
            a.prior2_cf_profitability,
            a.current_parta_ramra_pa,
            a.prior_parta_ramra_pa,
            a.prior2_parta_ramra_pa,
            a.current_partb_ramra_pa,
            a.prior_partb_ramra_pa,
            a.prior2_partb_ramra_pa,
            a.current_hra_completed,
            a.prior_hra_completed,
            a.prior2_hra_completed
      from member_index_incremental a
      left join new_anonymized_member_master b on a.member_id = b.member_id

# Note: Load tables have to be same as Extract tables.
Load:

  members_full:
    load_1:
      type: parquet
      location: '{aggr_location}/members_full'
      mode: overwrite

  anonymized_members_incremental:
    load_1:
      type: parquet
      location: '{project_root_path}/{client}/sync/members_incremental'
      mode: overwrite

  member_index_full:
    load_1:
      type: parquet
      location: '{aggr_location}/member_index_full'
      mode: overwrite

  anonymized_member_index_incremental:
    load_1:
      type: parquet
      location: '{project_root_path}/{client}/sync/member_index_incremental'
      mode: overwrite

  new_rows_anonymized_member_master:
    load_1:
      type: parquet
      location: '{aggr_location}/anonymized_member_master'
      mode: append
debug: false

#    """
#    Logic:
#        1- load the history table for the member index sync table only include the records with
#           the last job_id present in the history table
#        2- create the full data for member index
#        3- compare the full data against the last history data to create the incremental table with 3 operations
#         INSERT if records are present in the full table but not in the history (using the pk for the comparison
#         DELETE if records are present in the history  table but not in the full table
#         UPDATE If recorda are present in both tables (history and full) but the hash value is different
#    """

# Files to Load / Create View
variables:
  - project_root_path = {config.project_root_path}
#  - cad_job_id = {config.job_id}
  - client = {config.client}
  - aggr_location =  {config.aggr_location}
  - debug = False

Extract:
  member_index_history:
    type: parquet
    location: "{aggr_location}/member_index_history/"

  job:
    type: postgres
    conn_config_name: cadmium_postgres_db
    table_name: job

#main members data
  members_full:
    type: parquet
    location: "{aggr_location}/members_full"

#main member numbers by year
  eamd:
    type: parquet
    location: "{project_root_path}/{client}/EAMD/"

#  ref table for raf type description
  raf_type_code_client_type:
    type: parquet
    location: "{project_root_path}/{client}/raf_type_code_client_type/"

  rafxdatasample:
    type: parquet
    location: "{project_root_path}/{client}/RAFxDataSample/"

  rafxresultsv2:
    type: parquet
    location: "{project_root_path}/{client}/RAFxResultsV2/"

# array of  captured hccs and suspect hccs
  member_hcc_arrays:
    type: parquet
    location: "{aggr_location}/member_hcc_arrays"

#array of encounter diagnosis
  member_encounter_arrays:
    type: parquet
    location: "{aggr_location}/member_encounter_arrays"

#number of encounter with specs (non-pcp) providers
  spec_encounter_counts:
    type: parquet
    location: "{aggr_location}/spec_encounter_counts"

#list of related providers or pcp thru encounters
  provider_member_relationships_full:
    type: parquet
    location: "{aggr_location}/provider_member_relationships_full"

#main provider data
  providers_full:
    type: parquet
    location: "{aggr_location}/providers_full"

  member_hcc_nums:
    type: parquet
    location: "{aggr_location}/member_hcc_nums"

Transform:
  cad_job:
    sql: >-
      With LastJob as (
        SELECT
          max(id) as last_job_id,
          max(client_name) as client_name
          FROM job
          WHERE status = 'CLOSED' and client_name ='{client}'
        )
      SELECT
        max(j.id) as cad_job_id, max(coalesce(l.last_job_id,0)) as last_job_id
        FROM job j
        inner join LastJob l on j.client_name = l.client_name
        WHERE status = 'OPEN'
    cache: true


#  previous_load:
#    sql: >-
#      WITH allrows as (
#         SELECT
#            * , row_number() over(partition by member_id order by  job_id desc ) as r
#         FROM member_index_history)
#      SELECT
#         member_id,
#         hash_value,
#         job_id
#      FROM allrows
#      WHERE  r=1

  # previous job should ONLY include the table keys , hash values and job id for the previous job_id for the specific client
  previous_load:
    sql: >-
      SELECT
         member_id,
         hash_value,
         job_id
      FROM member_index_history m
      INNER JOIN cad_job  c on c.last_job_id =m.job_id
    cache: true

#             WHERE            b.provider_id in (
#             '1558336552',
#             '1912158726')
#             and  b.member_id in ('583147650A',  '582283994A' )
  member_index_full:
    sql: >-
      WITH
      MMR_values_by_year as (
            select
               i.member_id,
               i.PaymentYear - 1 as year,
               max(CASE WHEN ifnull(i.Hospice,'0') = '1'
                        THEN true
                        ELSE false END )
                  as mmr_hospice,
               max(r.description) as risk_code_description
            from
               RAFxDataSample i
               inner join    RAFxResultsV2 o  on i.RAFxData_Id = o.RAFxData_Id
               left join     raf_type_code_client_type  r on  o.raftypecode  =  r.raftypecode
            group by  i.member_id, i.PaymentYear - 1
      ),
        provider_info_table as (
          SELECT
            b.member_id,
            b.provider_id,
            struct(
              b.provider_id,
              b.relation_type,
              a.full_name,
              a.tax_id,
              a.is_acceptable,
              array (
                    taxonomy_code_1,
                    taxonomy_code_2,
                    taxonomy_code_3,
                    taxonomy_code_4,
                    taxonomy_code_5,
                    taxonomy_code_6,
                    taxonomy_code_7,
                    taxonomy_code_8,
                    taxonomy_code_9,
                    taxonomy_code_10
                ) as taxonomies
              ) as provider
       FROM  provider_member_relationships_full b
       INNER JOIN providers_full  a on b.provider_id = a.provider_id
      ),
      member_provider_info_table as (
        SELECT
          member_id,
          to_json(struct ( collect_set (provider))) as provider_info
        FROM provider_info_table
        GROUP BY member_id
      ),
      index as (
            SELECT
              a.member_id,
              a.hicn,
              a.mbi,
              a.external_member_id,
              a.full_name,
              a.first_name,
              a.last_name,
              a.date_of_birth,
              floor( months_between(current_date() , a.date_of_birth)/ 12) as age,
              a.gender,
              a.address_line_1,
              a.address_line_2,
              a.city,
              a.state,
              a.zip,
              a.phone,
              a.program,
              a.health_plan_member_id,
              a.health_plan_name,
              a.chart_delivered_count,
              a.flex1,
              a.flex2,
              a.flex3,
              a.flex4,
              a.flex5,
              a.flex6,
              a.flex7,
              a.flex8,
              a.flex9,
              a.flex10,
              a.pcp_id as pcp_provider_id ,
              concat(
              ifnull(trim(pcp.last_name),''),
               (case when ifnull(trim(pcp.first_name),'') = ''
              	THEN ''
                      else   concat( ',', trim(pcp.first_name) )
                 end )
              )  as pcp_name,
              pcp.npi as pcp_npi,
              pcp.tax_id as pcp_tax_id,
              pcp.flex1 as pcp_flex1,
              pcp.flex2 as pcp_flex2,
              pcp.flex3 as pcp_flex3,
              pcp.flex4 as pcp_flex4,
              pcp.flex5 as pcp_flex5,
              pcp.flex6 as pcp_flex6,
              pcp.flex7 as pcp_flex7,
              pcp.flex8 as pcp_flex8,
              pcp.flex9 as pcp_flex9,
              pcp.flex10 as pcp_flex10,
              x.provider_info,
              c.any_last_encounter as last_encounter,
              c.pcp_last_encounter as pcp_last_encounter,
              spec.spec_last_encounter as spec_last_encounter,
              ifnull(c.dos_count,0)  as current_dos_count ,
              ifnull(c.pcp_dos_count, 0)  as current_pcp_dos_count ,
              ifnull(p1.dos_count, 0)  as prior_dos_count ,
              ifnull(p1.pcp_dos_count,0)  as prior_pcp_dos_count ,
              ifnull(p2.dos_count, 0)  as prior2_dos_count ,
              ifnull(p2.pcp_dos_count,0)  as prior2_pcp_dos_count ,
              en.encountered_ids as encountered_ids ,
              case when ifnull(c.esrd, '0') in ( '1', 'Y')  then true else false end as current_mmr_esrd,
              case when ifnull(p1.esrd, '0') in ( '1', 'Y')  then true else false end as prior_mmr_esrd,
              case when ifnull(p2.esrd, '0') in ( '1', 'Y')  then true else false end as prior2_mmr_esrd,
              ifnull(mc.mmr_hospice, false) as current_mmr_hospice,
              ifnull(mp1.mmr_hospice, false) as prior_mmr_hospice,
              ifnull(mp2.mmr_hospice, false) as prior2_mmr_hospice,
              ifnull(c.risk_code_type, '') as current_mmr_risk_code_type,
              ifnull(p1.risk_code_type, '') as prior_mmr_risk_code_type,
              ifnull(p2.risk_code_type, '') as prior2_mmr_risk_code_type,
              ifnull(mc.risk_code_description, '') as current_mmr_risk_code_description,
              ifnull(mp1.risk_code_description, '') as prior_mmr_risk_code_description,
              ifnull(mp2.risk_code_description, '') as prior2_mmr_risk_code_description,
              ifnull(c.is_eligible, false)  as current_is_eligible,
              ifnull(p1.is_eligible, false)  as prior_is_eligible,
              ifnull(p2.is_eligible , false) as prior2_is_eligible,
              c.eligibility_date,
              c.eligibility_end_date,
              CASE
                  WHEN c.is_eligible = TRUE AND p1.is_eligible = TRUE THEN 'Existing'
                  WHEN c.is_eligible = TRUE AND  p1.is_eligible = FALSE THEN 'New'
                  WHEN c.is_eligible = FALSE AND  p1.is_eligible = TRUE THEN 'Churn'
                  ELSE NULL
              END AS current_eligibility_status,
              CASE
                  WHEN p1.is_eligible = TRUE AND p2.is_eligible = TRUE THEN 'Existing'
                  WHEN p1.is_eligible = TRUE AND  p2.is_eligible = FALSE THEN 'New'
                  WHEN p1.is_eligible = FALSE AND  p2.is_eligible = TRUE THEN 'Churn'
                  ELSE NULL
              END AS prior_eligibility_status,
              cast (null as string) as prior2_eligibility_status,
              ifnull(c.months_eligible,0) as current_num_months_eligible,
              ifnull(p1.months_eligible, 0) as  prior_num_months_eligible,
              ifnull(p2.months_eligible, 0) as prior2_num_months_eligible,
              ifnull(c.recap_count,0) as current_recap_count,
              ifnull(p1.recap_count,0) as prior_recap_count,
              ifnull(p2.recap_count,0) as prior2_recap_count,
              ifnull(c.recap_opp_count,0) as current_recap_opp_count,
              ifnull(p1.recap_opp_count, 0)  as prior_recap_opp_count,
              ifnull(p2.recap_opp_count, 0)  as prior2_recap_opp_count,
              ifnull(cast(c.wellness_visit as boolean), false)  as current_wellness_visit,
              ifnull(cast(p1.wellness_visit as boolean), false)  as prior_wellness_visit,
              ifnull(cast(p2.wellness_visit as boolean), false)  as prior2_wellness_visit,
              cast(c.raf_captured as double) as current_raf_captured,
              cast(p1.raf_captured as double) as prior_raf_captured,
              cast(p2.raf_captured as double) as prior2_raf_captured,
              cast(c.raf_demographic as double) as current_raf_demo,
              cast(p1.raf_demographic as double) as prior_raf_demo,
              cast(p2.raf_demographic as double) as prior2_raf_demo,
              cast(c.opportunity as double) as current_opportunity,
              cast(p1.opportunity as double) as prior_opportunity,
              cast(p2.opportunity as double) as prior2_opportunity,
              cast(c.raf_projected as double) as current_raf_projected,
              cast(p1.raf_projected as double) as prior_raf_projected,
              cast(p2.raf_projected as double) as prior2_raf_projected,
              hacur.hccs_array  as  current_hcc_cap ,
              hap1.hccs_array  as  prior_hcc_cap ,
              hap2.hccs_array  as  prior2_hcc_cap ,
              hscur.hccs_array  as  current_hcc_sus ,
              hsp1.hccs_array  as  prior_hcc_sus ,
              hsp2.hccs_array  as  prior2_hcc_sus ,
              cast(c.hcc_captured as double)  as  current_hcc_captured ,
              cast(p1.hcc_captured as double)   as  prior_hcc_captured ,
              cast(p2.hcc_captured as double)   as  prior2_hcc_captured ,
              c.hcc_captured_source_claim  as current_hcc_captured_source_claim ,
              p1.hcc_captured_source_claim  as prior_hcc_captured_source_claim ,
              p2.hcc_captured_source_claim  as prior2_hcc_captured_source_claim ,
              c.hcc_captured_source_hra  as current_hcc_captured_source_hra ,
              p1.hcc_captured_source_hra  as prior_hcc_captured_source_hra ,
              p2.hcc_captured_source_hra  as prior2_hcc_captured_source_hra ,
              c.hcc_captured_source_hra_crr  as current_hcc_captured_source_hra_crr ,
              p1.hcc_captured_source_hra_crr  as prior_hcc_captured_source_hra_crr ,
              p2.hcc_captured_source_hra_crr  as prior2_hcc_captured_source_hra_crr ,
              c.hcc_captured_source_mor  as current_hcc_captured_source_mor ,
              p1.hcc_captured_source_mor  as prior_hcc_captured_source_mor ,
              p2.hcc_captured_source_mor  as prior2_hcc_captured_source_mor ,
              c.hcc_captured_source_crr  as current_hcc_captured_source_crr ,
              p1.hcc_captured_source_crr  as prior_hcc_captured_source_crr ,
              p2.hcc_captured_source_crr  as prior2_hcc_captured_source_crr ,
              c.hcc_captured_source_other  as current_hcc_captured_source_other ,
              p1.hcc_captured_source_other  as prior_hcc_captured_source_other ,
              p2.hcc_captured_source_other  as prior2_hcc_captured_source_other ,
              c.hcc_captured_new_chronic  as current_hcc_captured_new_chronic ,
              p1.hcc_captured_new_chronic  as prior_hcc_captured_new_chronic ,
              p2.hcc_captured_new_chronic  as prior2_hcc_captured_new_chronic ,
              c.hcc_captured_yoy_recapture  as current_hcc_captured_yoy_recapture ,
              p1.hcc_captured_yoy_recapture  as prior_hcc_captured_yoy_recapture ,
              p2.hcc_captured_yoy_recapture  as prior2_hcc_captured_yoy_recapture ,
              c.hcc_captured_mor_new_chronic  as current_hcc_captured_mor_new_chronic ,
              p1.hcc_captured_mor_new_chronic  as prior_hcc_captured_mor_new_chronic ,
              p2.hcc_captured_mor_new_chronic  as prior2_hcc_captured_mor_new_chronic ,
              c.hcc_captured_mor_yoy_recapture  as current_hcc_captured_mor_yoy_recapture ,
              p1.hcc_captured_mor_yoy_recapture  as prior_hcc_captured_mor_yoy_recapture ,
              p2.hcc_captured_mor_yoy_recapture  as prior2_hcc_captured_mor_yoy_recapture ,
              c.hcc_captured_acute  as current_hcc_captured_acute ,
              p1.hcc_captured_acute  as prior_hcc_captured_acute ,
              p2.hcc_captured_acute  as prior2_hcc_captured_acute ,
              c.hcc_captured_other  as current_hcc_captured_other ,
              p1.hcc_captured_other  as prior_hcc_captured_other ,
              p2.hcc_captured_other  as prior2_hcc_captured_other ,
              c.hcc_suspects_all  as current_hcc_suspects_all ,
              p1.hcc_suspects_all  as prior_hcc_suspects_all ,
              p2.hcc_suspects_all  as prior2_hcc_suspects_all ,
              c.hcc_suspects_yoy  as current_hcc_suspects_yoy ,
              p1.hcc_suspects_yoy  as prior_hcc_suspects_yoy ,
              p2.hcc_suspects_yoy  as prior2_hcc_suspects_yoy ,
              c.hcc_suspects_mor_yoy  as current_hcc_suspects_mor_yoy ,
              p1.hcc_suspects_mor_yoy  as prior_hcc_suspects_mor_yoy ,
              p2.hcc_suspects_mor_yoy  as prior2_hcc_suspects_mor_yoy ,
              c.hcc_suspects_u  as current_hcc_suspects_u ,
              p1.hcc_suspects_u  as prior_hcc_suspects_u ,
              p2.hcc_suspects_u  as prior2_hcc_suspects_u ,
              c.hcc_suspects_asr  as current_hcc_suspects_asr ,
              p1.hcc_suspects_asr  as prior_hcc_suspects_asr ,
              p2.hcc_suspects_asr  as prior2_hcc_suspects_asr ,
              c.hcc_suspects_n  as current_hcc_suspects_n ,
              p1.hcc_suspects_n  as prior_hcc_suspects_n ,
              p2.hcc_suspects_n  as prior2_hcc_suspects_n ,
              c.hcc_suspects_cpt  as current_hcc_suspects_cpt ,
              p1.hcc_suspects_cpt  as prior_hcc_suspects_cpt ,
              p2.hcc_suspects_cpt  as prior2_hcc_suspects_cpt ,
              c.hcc_suspects_ml  as current_hcc_suspects_ml ,
              p1.hcc_suspects_ml  as prior_hcc_suspects_ml ,
              p2.hcc_suspects_ml  as prior2_hcc_suspects_ml ,
              c.hcc_suspects_other  as current_hcc_suspects_other ,
              p1.hcc_suspects_other  as prior_hcc_suspects_other ,
              p2.hcc_suspects_other  as prior2_hcc_suspects_other ,
              c.hcc_suspects_clinical  as current_hcc_suspects_clinical ,
              p1.hcc_suspects_clinical  as prior_hcc_suspects_clinical ,
              p2.hcc_suspects_clinical  as prior2_hcc_suspects_clinical ,
              numc.hcc_num_all as current_hcc_captured_num_all ,
              nump1.hcc_num_all as prior_hcc_captured_num_all ,
              nump2.hcc_num_all as prior2_hcc_captured_num_all ,
              c.hcc_captured_num_source_claim  as current_hcc_captured_num_source_claim ,
              p1.hcc_captured_num_source_claim  as prior_hcc_captured_num_source_claim ,
              p2.hcc_captured_num_source_claim  as prior2_hcc_captured_num_source_claim ,
              c.hcc_captured_num_source_hra  as current_hcc_captured_num_source_hra ,
              p1.hcc_captured_num_source_hra  as prior_hcc_captured_num_source_hra ,
              p2.hcc_captured_num_source_hra  as prior2_hcc_captured_num_source_hra ,
              c.hcc_captured_num_source_hra_crr  as current_hcc_captured_num_source_hra_crr ,
              p1.hcc_captured_num_source_hra_crr  as prior_hcc_captured_num_source_hra_crr ,
              p2.hcc_captured_num_source_hra_crr  as prior2_hcc_captured_num_source_hra_crr ,
              c.hcc_captured_num_source_mor  as current_hcc_captured_num_source_mor ,
              p1.hcc_captured_num_source_mor  as prior_hcc_captured_num_source_mor ,
              p2.hcc_captured_num_source_mor  as prior2_hcc_captured_num_source_mor ,
              c.hcc_captured_num_source_crr  as current_hcc_captured_num_source_crr ,
              p1.hcc_captured_num_source_crr  as prior_hcc_captured_num_source_crr ,
              p2.hcc_captured_num_source_crr  as prior2_hcc_captured_num_source_crr ,
              c.hcc_captured_num_source_other  as current_hcc_captured_num_source_other ,
              p1.hcc_captured_num_source_other  as prior_hcc_captured_num_source_other ,
              p2.hcc_captured_num_source_other  as prior2_hcc_captured_num_source_other ,
              c.hcc_captured_num_new_chronic  as current_hcc_captured_num_new_chronic ,
              p1.hcc_captured_num_new_chronic  as prior_hcc_captured_num_new_chronic ,
              p2.hcc_captured_num_new_chronic  as prior2_hcc_captured_num_new_chronic ,
              c.hcc_captured_num_yoy_recapture  as current_hcc_captured_num_yoy_recapture ,
              p1.hcc_captured_num_yoy_recapture  as prior_hcc_captured_num_yoy_recapture ,
              p2.hcc_captured_num_yoy_recapture  as prior2_hcc_captured_num_yoy_recapture ,
              c.hcc_captured_num_mor_new_chronic  as current_hcc_captured_num_mor_new_chronic ,
              p1.hcc_captured_num_mor_new_chronic  as prior_hcc_captured_num_mor_new_chronic ,
              p2.hcc_captured_num_mor_new_chronic  as prior2_hcc_captured_num_mor_new_chronic ,
              c.hcc_captured_num_mor_yoy_recapture  as current_hcc_captured_num_mor_yoy_recapture ,
              p1.hcc_captured_num_mor_yoy_recapture  as prior_hcc_captured_num_mor_yoy_recapture ,
              p2.hcc_captured_num_mor_yoy_recapture  as prior2_hcc_captured_num_mor_yoy_recapture ,
              c.hcc_captured_num_acute  as current_hcc_captured_num_acute ,
              p1.hcc_captured_num_acute  as prior_hcc_captured_num_acute ,
              p2.hcc_captured_num_acute  as prior2_hcc_captured_num_acute ,
              c.hcc_captured_num_other  as current_hcc_captured_num_other ,
              p1.hcc_captured_num_other  as prior_hcc_captured_num_other ,
              p2.hcc_captured_num_other  as prior2_hcc_captured_num_other ,
              numsc.hcc_num_all as current_hcc_suspects_num_all ,
              numsp1.hcc_num_all as prior_hcc_suspects_num_all ,
              numsp2.hcc_num_all as prior2_hcc_suspects_num_all ,
              c.hcc_suspects_num_yoy  as current_hcc_suspects_num_yoy ,
              p1.hcc_suspects_num_yoy  as prior_hcc_suspects_num_yoy ,
              p2.hcc_suspects_num_yoy  as prior2_hcc_suspects_num_yoy ,
              c.hcc_suspects_num_mor_yoy  as current_hcc_suspects_num_mor_yoy ,
              p1.hcc_suspects_num_mor_yoy  as prior_hcc_suspects_num_mor_yoy ,
              p2.hcc_suspects_num_mor_yoy  as prior2_hcc_suspects_num_mor_yoy ,
              c.hcc_suspects_num_u  as current_hcc_suspects_num_u ,
              p1.hcc_suspects_num_u  as prior_hcc_suspects_num_u ,
              p2.hcc_suspects_num_u  as prior2_hcc_suspects_num_u ,
              c.hcc_suspects_num_asr  as current_hcc_suspects_num_asr ,
              p1.hcc_suspects_num_asr  as prior_hcc_suspects_num_asr ,
              p2.hcc_suspects_num_asr  as prior2_hcc_suspects_num_asr ,
              c.hcc_suspects_num_n  as current_hcc_suspects_num_n ,
              p1.hcc_suspects_num_n  as prior_hcc_suspects_num_n ,
              p2.hcc_suspects_num_n  as prior2_hcc_suspects_num_n ,
              c.hcc_suspects_num_cpt  as current_hcc_suspects_num_cpt ,
              p1.hcc_suspects_num_cpt  as prior_hcc_suspects_num_cpt ,
              p2.hcc_suspects_num_cpt  as prior2_hcc_suspects_num_cpt ,
              c.hcc_suspects_num_ml  as current_hcc_suspects_num_ml ,
              p1.hcc_suspects_num_ml  as prior_hcc_suspects_num_ml ,
              p2.hcc_suspects_num_ml  as prior2_hcc_suspects_num_ml ,
              c.hcc_suspects_num_other  as current_hcc_suspects_num_other ,
              p1.hcc_suspects_num_other  as prior_hcc_suspects_num_other ,
              p2.hcc_suspects_num_other  as prior2_hcc_suspects_num_other ,
              c.hcc_suspects_num_clinical  as current_hcc_suspects_num_clinical ,
              p1.hcc_suspects_num_clinical  as prior_hcc_suspects_num_clinical ,
              p2.hcc_suspects_num_clinical  as prior2_hcc_suspects_num_clinical ,
              c.raf_profitability  as current_raf_profitability ,
              p1.raf_profitability  as prior_raf_profitability ,
              p2.raf_profitability  as prior2_raf_profitability ,
              CASE WHEN ifnull( c.medicaid, '') = 'Y' THEN true ELSE false end   as current_dual ,
              CASE WHEN (ifnull( p1.medicaid, '') = 'Y' or  ifnull( p2.medicaid, '') ='Y')  and  ifnull( c.medicaid, '') <> 'Y'  THEN true ELSE false end   as current_dual_opp ,
              CASE WHEN  ifnull( p1.medicaid, '') = 'Y'  THEN true ELSE false end   as prior_dual ,
              CASE WHEN ifnull( p2.medicaid, '') = 'Y' and ifnull( p1.medicaid, '') <> 'Y'   THEN true ELSE false end   as prior_dual_opp ,
              CASE WHEN ifnull( p2.medicaid, '') = 'Y' THEN true ELSE false end   as prior2_dual ,
              CASE WHEN  ifnull( p2.medicaid, '') <> 'Y'  THEN true ELSE false end   as prior2_dual_opp ,
              c.dual_opp_score   as current_dual_opp_score ,
              p1.dual_opp_score   as prior_dual_opp_score ,
              p2.dual_opp_score   as prior2_dual_opp_score ,
              c.raf_captured_cf   as current_raf_captured_cf ,
              p1.raf_captured_cf   as prior_raf_captured_cf ,
              p2.raf_captured_cf   as prior2_raf_captured_cf ,
              c.raf_dual_boost   as current_raf_dual_boost ,
              p1.raf_dual_boost   as prior_raf_dual_boost ,
              p2.raf_dual_boost   as prior2_raf_dual_boost ,
              c.cf_profitability   as current_cf_profitability ,
              p1.cf_profitability   as prior_cf_profitability ,
              p2.cf_profitability   as prior2_cf_profitability ,
              c.parta_ramra_pa  as current_parta_ramra_pa ,
              p1.parta_ramra_pa  as prior_parta_ramra_pa ,
              p2.parta_ramra_pa  as prior2_parta_ramra_pa ,
              c.partb_ramra_pa  as current_partb_ramra_pa ,
              p1.partb_ramra_pa  as prior_partb_ramra_pa ,
              p2.partb_ramra_pa  as prior2_partb_ramra_pa ,
              coalesce(c.hra_completed, false)  as current_hra_completed ,
              coalesce(p1.hra_completed, false)  as prior_hra_completed ,
              coalesce(p2.hra_completed, false)  as prior2_hra_completed
              FROM members_full a
              LEFT JOIN providers_full pcp on a.pcp_id = pcp.provider_id
              LEFT JOIN  member_provider_info_table x on x.member_id = a.member_id
              LEFT JOIN EAMD c on a.member_id= c.member_id and c.year_name = 'current'
              LEFT JOIN EAMD p1 on a.member_id= p1.member_id  and p1.year_name = 'prior'
              LEFT JOIN EAMD p2 on a.member_id= p2.member_id  and p2.year_name ='prior2'
              LEFT JOIN MMR_values_by_year mc on a.member_id = mc.member_id and c.year = mc.year
              LEFT JOIN MMR_values_by_year mp1 on a.member_id = mp1.member_id and p1.year = mp1.year
              LEFT JOIN MMR_values_by_year mp2 on a.member_id = mp2.member_id and p2.year = mp2.year
              LEFT JOIN member_encounter_arrays en on en.member_id = a.member_id
              LEFT JOIN member_hcc_arrays hacur on hacur.member_id = a.member_id and hacur.year = c.year and upper(hacur.hcc_type)= 'CAPTURED'
              LEFT JOIN member_hcc_arrays hap1 on hap1.member_id = a.member_id and hap1.year = p1.year and upper(hap1.hcc_type)= 'CAPTURED'
              LEFT JOIN member_hcc_arrays hap2 on hap2.member_id = a.member_id and hap2.year = p2.year and upper(hap2.hcc_type)= 'CAPTURED'
              LEFT JOIN member_hcc_arrays hscur on hscur.member_id = a.member_id and hscur.year = c.year and upper(hscur.hcc_type)= 'SUSPECT'
              LEFT JOIN member_hcc_arrays hsp1 on hsp1.member_id = a.member_id and hsp1.year = p1.year and upper(hsp1.hcc_type)= 'SUSPECT'
              LEFT JOIN member_hcc_arrays hsp2 on hsp2.member_id = a.member_id and hsp2.year = p2.year and upper(hsp2.hcc_type)= 'SUSPECT'
              LEFT JOIN spec_encounter_counts spec on spec.member_id = a.member_id
              LEFT JOIN member_hcc_nums numc on numc.member_id = a.member_id and numc.year = c.year and upper(numc.hcc_type)= 'CAPTURED'
              LEFT JOIN member_hcc_nums nump1 on nump1.member_id = a.member_id and nump1.year = p1.year and upper(nump1.hcc_type)= 'CAPTURED'
              LEFT JOIN member_hcc_nums nump2 on nump2.member_id = a.member_id and nump2.year = p2.year and upper(nump2.hcc_type)= 'CAPTURED'
              LEFT JOIN member_hcc_nums numsc on numsc.member_id = a.member_id and numsc.year = c.year and upper(numsc.hcc_type)= 'SUSPECT'
              LEFT JOIN member_hcc_nums numsp1 on numsp1.member_id = a.member_id and numsp1.year = p1.year and upper(numsp1.hcc_type)= 'SUSPECT'
              LEFT JOIN member_hcc_nums numsp2 on numsp2.member_id = a.member_id and numsp2.year = p2.year and upper(numsp2.hcc_type)= 'SUSPECT'
      )
      SELECT *,
        hash(
                    member_id,
                    hicn,
                    mbi,
                    external_member_id,
                    full_name,
                    first_name,
                    last_name,
                    date_of_birth,
                    age,
                    gender,
                    address_line_1,
                    address_line_2,
                    city,
                    state,
                    zip,
                    phone,
                    program,
                    health_plan_member_id,
                    health_plan_name,
                    chart_delivered_count,
                    flex1,
                    flex2,
                    flex3,
                    flex4,
                    flex5,
                    flex6,
                    flex7,
                    flex8,
                    flex9,
                    flex10,
                    pcp_provider_id,
                    pcp_name,
                    pcp_npi,
                    pcp_tax_id,
                    pcp_flex1,
                    pcp_flex2,
                    pcp_flex3,
                    pcp_flex4,
                    pcp_flex5,
                    pcp_flex6,
                    pcp_flex7,
                    pcp_flex8,
                    pcp_flex9,
                    pcp_flex10,
                    provider_info,
                    last_encounter,
                    pcp_last_encounter,
                    spec_last_encounter,
                    current_dos_count,
                    current_pcp_dos_count,
                    prior_dos_count,
                    prior_pcp_dos_count,
                    prior2_dos_count,
                    prior2_pcp_dos_count,
                    encountered_ids,
                    current_mmr_esrd,
                    prior_mmr_esrd,
                    prior2_mmr_esrd,
                    current_mmr_hospice,
                    prior_mmr_hospice,
                    prior2_mmr_hospice,
                    current_mmr_risk_code_type,
                    prior_mmr_risk_code_type,
                    prior2_mmr_risk_code_type,
                    current_mmr_risk_code_description,
                    prior_mmr_risk_code_description,
                    prior2_mmr_risk_code_description,
                    current_is_eligible,
                    prior_is_eligible,
                    prior2_is_eligible,
                    eligibility_date,
                    eligibility_end_date,
                    current_eligibility_status,
                    prior_eligibility_status,
                    prior2_eligibility_status,
                    current_num_months_eligible,
                    prior_num_months_eligible,
                    prior2_num_months_eligible,
                    current_recap_count,
                    prior_recap_count,
                    prior2_recap_count,
                    current_recap_opp_count,
                    prior_recap_opp_count,
                    prior2_recap_opp_count,
                    current_wellness_visit,
                    prior_wellness_visit,
                    prior2_wellness_visit,
                    current_raf_captured,
                    prior_raf_captured,
                    prior2_raf_captured,
                    current_raf_demo,
                    prior_raf_demo,
                    prior2_raf_demo,
                    current_opportunity,
                    prior_opportunity,
                    prior2_opportunity,
                    current_raf_projected,
                    prior_raf_projected,
                    prior2_raf_projected,
                    current_hcc_cap,
                    prior_hcc_cap,
                    prior2_hcc_cap,
                    current_hcc_sus,
                    prior_hcc_sus,
                    prior2_hcc_sus,
                    current_hcc_captured,
                    prior_hcc_captured,
                    prior2_hcc_captured,
                    current_hcc_captured_source_claim,
                    prior_hcc_captured_source_claim,
                    prior2_hcc_captured_source_claim,
                    current_hcc_captured_source_hra,
                    prior_hcc_captured_source_hra,
                    prior2_hcc_captured_source_hra,
                    current_hcc_captured_source_hra_crr,
                    prior_hcc_captured_source_hra_crr,
                    prior2_hcc_captured_source_hra_crr,
                    current_hcc_captured_source_mor,
                    prior_hcc_captured_source_mor,
                    prior2_hcc_captured_source_mor,
                    current_hcc_captured_source_crr,
                    prior_hcc_captured_source_crr,
                    prior2_hcc_captured_source_crr,
                    current_hcc_captured_source_other,
                    prior_hcc_captured_source_other,
                    prior2_hcc_captured_source_other,
                    current_hcc_captured_new_chronic,
                    prior_hcc_captured_new_chronic,
                    prior2_hcc_captured_new_chronic,
                    current_hcc_captured_yoy_recapture,
                    prior_hcc_captured_yoy_recapture,
                    prior2_hcc_captured_yoy_recapture,
                    current_hcc_captured_mor_new_chronic,
                    prior_hcc_captured_mor_new_chronic,
                    prior2_hcc_captured_mor_new_chronic,
                    current_hcc_captured_mor_yoy_recapture,
                    prior_hcc_captured_mor_yoy_recapture,
                    prior2_hcc_captured_mor_yoy_recapture,
                    current_hcc_captured_acute,
                    prior_hcc_captured_acute,
                    prior2_hcc_captured_acute,
                    current_hcc_captured_other,
                    prior_hcc_captured_other,
                    prior2_hcc_captured_other,
                    current_hcc_suspects_all,
                    prior_hcc_suspects_all,
                    prior2_hcc_suspects_all,
                    current_hcc_suspects_yoy,
                    prior_hcc_suspects_yoy,
                    prior2_hcc_suspects_yoy,
                    current_hcc_suspects_mor_yoy,
                    prior_hcc_suspects_mor_yoy,
                    prior2_hcc_suspects_mor_yoy,
                    current_hcc_suspects_u,
                    prior_hcc_suspects_u,
                    prior2_hcc_suspects_u,
                    current_hcc_suspects_asr,
                    prior_hcc_suspects_asr,
                    prior2_hcc_suspects_asr,
                    current_hcc_suspects_n,
                    prior_hcc_suspects_n,
                    prior2_hcc_suspects_n,
                    current_hcc_suspects_cpt,
                    prior_hcc_suspects_cpt,
                    prior2_hcc_suspects_cpt,
                    current_hcc_suspects_ml,
                    prior_hcc_suspects_ml,
                    prior2_hcc_suspects_ml,
                    current_hcc_suspects_other,
                    prior_hcc_suspects_other,
                    prior2_hcc_suspects_other,
                    current_hcc_suspects_clinical,
                    prior_hcc_suspects_clinical,
                    prior2_hcc_suspects_clinical,
                    current_hcc_captured_num_all,
                    prior_hcc_captured_num_all,
                    prior2_hcc_captured_num_all,
                    current_hcc_captured_num_source_claim,
                    prior_hcc_captured_num_source_claim,
                    prior2_hcc_captured_num_source_claim,
                    current_hcc_captured_num_source_hra,
                    prior_hcc_captured_num_source_hra,
                    prior2_hcc_captured_num_source_hra,
                    current_hcc_captured_num_source_hra_crr,
                    prior_hcc_captured_num_source_hra_crr,
                    prior2_hcc_captured_num_source_hra_crr,
                    current_hcc_captured_num_source_mor,
                    prior_hcc_captured_num_source_mor,
                    prior2_hcc_captured_num_source_mor,
                    current_hcc_captured_num_source_crr,
                    prior_hcc_captured_num_source_crr,
                    prior2_hcc_captured_num_source_crr,
                    current_hcc_captured_num_source_other,
                    prior_hcc_captured_num_source_other,
                    prior2_hcc_captured_num_source_other,
                    current_hcc_captured_num_new_chronic,
                    prior_hcc_captured_num_new_chronic,
                    prior2_hcc_captured_num_new_chronic,
                    current_hcc_captured_num_yoy_recapture,
                    prior_hcc_captured_num_yoy_recapture,
                    prior2_hcc_captured_num_yoy_recapture,
                    current_hcc_captured_num_mor_new_chronic,
                    prior_hcc_captured_num_mor_new_chronic,
                    prior2_hcc_captured_num_mor_new_chronic,
                    current_hcc_captured_num_mor_yoy_recapture,
                    prior_hcc_captured_num_mor_yoy_recapture,
                    prior2_hcc_captured_num_mor_yoy_recapture,
                    current_hcc_captured_num_acute,
                    prior_hcc_captured_num_acute,
                    prior2_hcc_captured_num_acute,
                    current_hcc_captured_num_other,
                    prior_hcc_captured_num_other,
                    prior2_hcc_captured_num_other,
                    current_hcc_suspects_num_all,
                    prior_hcc_suspects_num_all,
                    prior2_hcc_suspects_num_all,
                    current_hcc_suspects_num_yoy,
                    prior_hcc_suspects_num_yoy,
                    prior2_hcc_suspects_num_yoy,
                    current_hcc_suspects_num_mor_yoy,
                    prior_hcc_suspects_num_mor_yoy,
                    prior2_hcc_suspects_num_mor_yoy,
                    current_hcc_suspects_num_u,
                    prior_hcc_suspects_num_u,
                    prior2_hcc_suspects_num_u,
                    current_hcc_suspects_num_asr,
                    prior_hcc_suspects_num_asr,
                    prior2_hcc_suspects_num_asr,
                    current_hcc_suspects_num_n,
                    prior_hcc_suspects_num_n,
                    prior2_hcc_suspects_num_n,
                    current_hcc_suspects_num_cpt,
                    prior_hcc_suspects_num_cpt,
                    prior2_hcc_suspects_num_cpt,
                    current_hcc_suspects_num_ml,
                    prior_hcc_suspects_num_ml,
                    prior2_hcc_suspects_num_ml,
                    current_hcc_suspects_num_other,
                    prior_hcc_suspects_num_other,
                    prior2_hcc_suspects_num_other,
                    current_hcc_suspects_num_clinical,
                    prior_hcc_suspects_num_clinical,
                    prior2_hcc_suspects_num_clinical,
                    current_raf_profitability,
                    prior_raf_profitability,
                    prior2_raf_profitability,
                    current_dual,
                    current_dual_opp,
                    prior_dual,
                    prior_dual_opp,
                    prior2_dual,
                    prior2_dual_opp,
                    current_dual_opp_score,
                    prior_dual_opp_score,
                    prior2_dual_opp_score,
                    current_raf_captured_cf,
                    prior_raf_captured_cf,
                    prior2_raf_captured_cf,
                    current_raf_dual_boost,
                    prior_raf_dual_boost,
                    prior2_raf_dual_boost,
                    current_cf_profitability,
                    prior_cf_profitability,
                    prior2_cf_profitability,
                    current_parta_ramra_pa,
                    prior_parta_ramra_pa,
                    prior2_parta_ramra_pa,
                    current_partb_ramra_pa,
                    prior_partb_ramra_pa,
                    prior2_partb_ramra_pa,
                    current_hra_completed,
                    prior_hra_completed,
                    prior2_hra_completed
              ) as hash_value,
             ( select cad_job_id from cad_job )  as job_id
        FROM index

  member_index_incremental:
    sql: >-
      WITH new_rows as (
           SELECT
            a.hash_value,
            'INSERT' as operation,
            a.job_id,
            a.member_id,
            a.hicn,
            a.mbi,
            a.external_member_id,
            a.full_name,
            a.first_name,
            a.last_name,
            a.date_of_birth,
            a.age,
            a.gender,
            a.address_line_1,
            a.address_line_2,
            a.city,
            a.state,
            a.zip,
            a.phone,
            a.program,
            a.health_plan_member_id,
            a.health_plan_name,
            a.chart_delivered_count,
            a.flex1,
            a.flex2,
            a.flex3,
            a.flex4,
            a.flex5,
            a.flex6,
            a.flex7,
            a.flex8,
            a.flex9,
            a.flex10,
            a.pcp_provider_id,
            a.pcp_name,
            a.pcp_npi,
            a.pcp_tax_id,
            a.pcp_flex1,
            a.pcp_flex2,
            a.pcp_flex3,
            a.pcp_flex4,
            a.pcp_flex5,
            a.pcp_flex6,
            a.pcp_flex7,
            a.pcp_flex8,
            a.pcp_flex9,
            a.pcp_flex10,
            a.provider_info,
            a.last_encounter,
            a.pcp_last_encounter,
            a.spec_last_encounter,
            a.current_dos_count,
            a.current_pcp_dos_count,
            a.prior_dos_count,
            a.prior_pcp_dos_count,
            a.prior2_dos_count,
            a.prior2_pcp_dos_count,
            a.encountered_ids,
            a.current_mmr_esrd,
            a.prior_mmr_esrd,
            a.prior2_mmr_esrd,
            a.current_mmr_hospice,
            a.prior_mmr_hospice,
            a.prior2_mmr_hospice,
            a.current_mmr_risk_code_type,
            a.prior_mmr_risk_code_type,
            a.prior2_mmr_risk_code_type,
            a.current_mmr_risk_code_description,
            a.prior_mmr_risk_code_description,
            a.prior2_mmr_risk_code_description,
            a.current_is_eligible,
            a.prior_is_eligible,
            a.prior2_is_eligible,
            a.eligibility_date,
            a.eligibility_end_date,
            a.current_eligibility_status,
            a.prior_eligibility_status,
            a.prior2_eligibility_status,
            a.current_num_months_eligible,
            a.prior_num_months_eligible,
            a.prior2_num_months_eligible,
            a.current_recap_count,
            a.prior_recap_count,
            a.prior2_recap_count,
            a.current_recap_opp_count,
            a.prior_recap_opp_count,
            a.prior2_recap_opp_count,
            a.current_wellness_visit,
            a.prior_wellness_visit,
            a.prior2_wellness_visit,
            a.current_raf_captured,
            a.prior_raf_captured,
            a.prior2_raf_captured,
            a.current_raf_demo,
            a.prior_raf_demo,
            a.prior2_raf_demo,
            a.current_opportunity,
            a.prior_opportunity,
            a.prior2_opportunity,
            a.current_raf_projected,
            a.prior_raf_projected,
            a.prior2_raf_projected,
            a.current_hcc_cap,
            a.prior_hcc_cap,
            a.prior2_hcc_cap,
            a.current_hcc_sus,
            a.prior_hcc_sus,
            a.prior2_hcc_sus,
            a.current_hcc_captured,
            a.prior_hcc_captured,
            a.prior2_hcc_captured,
            a.current_hcc_captured_source_claim,
            a.prior_hcc_captured_source_claim,
            a.prior2_hcc_captured_source_claim,
            a.current_hcc_captured_source_hra,
            a.prior_hcc_captured_source_hra,
            a.prior2_hcc_captured_source_hra,
            a.current_hcc_captured_source_hra_crr,
            a.prior_hcc_captured_source_hra_crr,
            a.prior2_hcc_captured_source_hra_crr,
            a.current_hcc_captured_source_mor,
            a.prior_hcc_captured_source_mor,
            a.prior2_hcc_captured_source_mor,
            a.current_hcc_captured_source_crr,
            a.prior_hcc_captured_source_crr,
            a.prior2_hcc_captured_source_crr,
            a.current_hcc_captured_source_other,
            a.prior_hcc_captured_source_other,
            a.prior2_hcc_captured_source_other,
            a.current_hcc_captured_new_chronic,
            a.prior_hcc_captured_new_chronic,
            a.prior2_hcc_captured_new_chronic,
            a.current_hcc_captured_yoy_recapture,
            a.prior_hcc_captured_yoy_recapture,
            a.prior2_hcc_captured_yoy_recapture,
            a.current_hcc_captured_mor_new_chronic,
            a.prior_hcc_captured_mor_new_chronic,
            a.prior2_hcc_captured_mor_new_chronic,
            a.current_hcc_captured_mor_yoy_recapture,
            a.prior_hcc_captured_mor_yoy_recapture,
            a.prior2_hcc_captured_mor_yoy_recapture,
            a.current_hcc_captured_acute,
            a.prior_hcc_captured_acute,
            a.prior2_hcc_captured_acute,
            a.current_hcc_captured_other,
            a.prior_hcc_captured_other,
            a.prior2_hcc_captured_other,
            a.current_hcc_suspects_all,
            a.prior_hcc_suspects_all,
            a.prior2_hcc_suspects_all,
            a.current_hcc_suspects_yoy,
            a.prior_hcc_suspects_yoy,
            a.prior2_hcc_suspects_yoy,
            a.current_hcc_suspects_mor_yoy,
            a.prior_hcc_suspects_mor_yoy,
            a.prior2_hcc_suspects_mor_yoy,
            a.current_hcc_suspects_u,
            a.prior_hcc_suspects_u,
            a.prior2_hcc_suspects_u,
            a.current_hcc_suspects_asr,
            a.prior_hcc_suspects_asr,
            a.prior2_hcc_suspects_asr,
            a.current_hcc_suspects_n,
            a.prior_hcc_suspects_n,
            a.prior2_hcc_suspects_n,
            a.current_hcc_suspects_cpt,
            a.prior_hcc_suspects_cpt,
            a.prior2_hcc_suspects_cpt,
            a.current_hcc_suspects_ml,
            a.prior_hcc_suspects_ml,
            a.prior2_hcc_suspects_ml,
            a.current_hcc_suspects_other,
            a.prior_hcc_suspects_other,
            a.prior2_hcc_suspects_other,
            a.current_hcc_suspects_clinical,
            a.prior_hcc_suspects_clinical,
            a.prior2_hcc_suspects_clinical,
            a.current_hcc_captured_num_all,
            a.prior_hcc_captured_num_all,
            a.prior2_hcc_captured_num_all,
            a.current_hcc_captured_num_source_claim,
            a.prior_hcc_captured_num_source_claim,
            a.prior2_hcc_captured_num_source_claim,
            a.current_hcc_captured_num_source_hra,
            a.prior_hcc_captured_num_source_hra,
            a.prior2_hcc_captured_num_source_hra,
            a.current_hcc_captured_num_source_hra_crr,
            a.prior_hcc_captured_num_source_hra_crr,
            a.prior2_hcc_captured_num_source_hra_crr,
            a.current_hcc_captured_num_source_mor,
            a.prior_hcc_captured_num_source_mor,
            a.prior2_hcc_captured_num_source_mor,
            a.current_hcc_captured_num_source_crr,
            a.prior_hcc_captured_num_source_crr,
            a.prior2_hcc_captured_num_source_crr,
            a.current_hcc_captured_num_source_other,
            a.prior_hcc_captured_num_source_other,
            a.prior2_hcc_captured_num_source_other,
            a.current_hcc_captured_num_new_chronic,
            a.prior_hcc_captured_num_new_chronic,
            a.prior2_hcc_captured_num_new_chronic,
            a.current_hcc_captured_num_yoy_recapture,
            a.prior_hcc_captured_num_yoy_recapture,
            a.prior2_hcc_captured_num_yoy_recapture,
            a.current_hcc_captured_num_mor_new_chronic,
            a.prior_hcc_captured_num_mor_new_chronic,
            a.prior2_hcc_captured_num_mor_new_chronic,
            a.current_hcc_captured_num_mor_yoy_recapture,
            a.prior_hcc_captured_num_mor_yoy_recapture,
            a.prior2_hcc_captured_num_mor_yoy_recapture,
            a.current_hcc_captured_num_acute,
            a.prior_hcc_captured_num_acute,
            a.prior2_hcc_captured_num_acute,
            a.current_hcc_captured_num_other,
            a.prior_hcc_captured_num_other,
            a.prior2_hcc_captured_num_other,
            a.current_hcc_suspects_num_all,
            a.prior_hcc_suspects_num_all,
            a.prior2_hcc_suspects_num_all,
            a.current_hcc_suspects_num_yoy,
            a.prior_hcc_suspects_num_yoy,
            a.prior2_hcc_suspects_num_yoy,
            a.current_hcc_suspects_num_mor_yoy,
            a.prior_hcc_suspects_num_mor_yoy,
            a.prior2_hcc_suspects_num_mor_yoy,
            a.current_hcc_suspects_num_u,
            a.prior_hcc_suspects_num_u,
            a.prior2_hcc_suspects_num_u,
            a.current_hcc_suspects_num_asr,
            a.prior_hcc_suspects_num_asr,
            a.prior2_hcc_suspects_num_asr,
            a.current_hcc_suspects_num_n,
            a.prior_hcc_suspects_num_n,
            a.prior2_hcc_suspects_num_n,
            a.current_hcc_suspects_num_cpt,
            a.prior_hcc_suspects_num_cpt,
            a.prior2_hcc_suspects_num_cpt,
            a.current_hcc_suspects_num_ml,
            a.prior_hcc_suspects_num_ml,
            a.prior2_hcc_suspects_num_ml,
            a.current_hcc_suspects_num_other,
            a.prior_hcc_suspects_num_other,
            a.prior2_hcc_suspects_num_other,
            a.current_hcc_suspects_num_clinical,
            a.prior_hcc_suspects_num_clinical,
            a.prior2_hcc_suspects_num_clinical,
            a.current_raf_profitability,
            a.prior_raf_profitability,
            a.prior2_raf_profitability,
            a.current_dual,
            a.current_dual_opp,
            a.prior_dual,
            a.prior_dual_opp,
            a.prior2_dual,
            a.prior2_dual_opp,
            a.current_dual_opp_score,
            a.prior_dual_opp_score,
            a.prior2_dual_opp_score,
            a.current_raf_captured_cf,
            a.prior_raf_captured_cf,
            a.prior2_raf_captured_cf,
            a.current_raf_dual_boost,
            a.prior_raf_dual_boost,
            a.prior2_raf_dual_boost,
            a.current_cf_profitability,
            a.prior_cf_profitability,
            a.prior2_cf_profitability,
            a.current_parta_ramra_pa,
            a.prior_parta_ramra_pa,
            a.prior2_parta_ramra_pa,
            a.current_partb_ramra_pa,
            a.prior_partb_ramra_pa,
            a.prior2_partb_ramra_pa,
            a.current_hra_completed,
            a.prior_hra_completed,
            a.prior2_hra_completed
          FROM  member_index_full a
          LEFT JOIN  previous_load b on a.member_id = b.member_id 
          WHERE b.member_id is null ),
      delete_rows as (
          SELECT
             a.hash_value,
             'DELETE' as operation,
              ( select cad_job_id from cad_job ) as job_id,
             a.member_id,
              cast( null as string ) as  hicn,
              cast( null as string ) as  mbi,
              cast( null as string ) as  external_member_id,
              cast( null as string ) as  full_name,
              cast( null as string ) as  first_name,
              cast( null as string ) as  last_name,
              cast( null as date ) as  date_of_birth,
              cast( null as integer ) as  age,
              cast( null as string ) as  gender,
              cast( null as string ) as  address_line_1,
              cast( null as string ) as  address_line_2,
              cast( null as string ) as  city,
              cast( null as string ) as  state,
              cast( null as string ) as  zip,
              cast( null as string ) as  phone,
              cast( null as string ) as  program,
              cast( null as string ) as  health_plan_member_id,
              cast( null as string ) as  health_plan_name,
              cast( null as integer ) as  chart_delivered_count,
              cast( null as string ) as  flex1,
              cast( null as string ) as  flex2,
              cast( null as string ) as  flex3,
              cast( null as string ) as  flex4,
              cast( null as string ) as  flex5,
              cast( null as string ) as  flex6,
              cast( null as string ) as  flex7,
              cast( null as string ) as  flex8,
              cast( null as string ) as  flex9,
              cast( null as string ) as  flex10,
              cast( null as string ) as  pcp_provider_id,
              cast( null as string ) as  pcp_name,
              cast( null as string ) as  pcp_npi,
              cast( null as string ) as  pcp_tax_id,
              cast( null as string ) as  pcp_flex1,
              cast( null as string ) as  pcp_flex2,
              cast( null as string ) as  pcp_flex3,
              cast( null as string ) as  pcp_flex4,
              cast( null as string ) as  pcp_flex5,
              cast( null as string ) as  pcp_flex6,
              cast( null as string ) as  pcp_flex7,
              cast( null as string ) as  pcp_flex8,
              cast( null as string ) as  pcp_flex9,
              cast( null as string ) as  pcp_flex10,
              cast( null as string  ) as  provider_info,
              cast( null as date ) as  last_encounter,
              cast( null as date ) as  pcp_last_encounter,
              cast( null as date ) as  spec_last_encounter,
              cast( null as integer ) as  current_dos_count,
              cast( null as integer ) as  current_pcp_dos_count,
              cast( null as integer ) as  prior_dos_count,
              cast( null as integer ) as  prior_pcp_dos_count,
              cast( null as integer ) as  prior2_dos_count,
              cast( null as integer ) as  prior2_pcp_dos_count,
              array(' ',' ') as  encountered_ids,
              cast( null as boolean ) as  current_mmr_esrd,
              cast( null as boolean ) as  prior_mmr_esrd,
              cast( null as boolean ) as  prior2_mmr_esrd,
              cast( null as boolean ) as  current_mmr_hospice,
              cast( null as boolean ) as  prior_mmr_hospice,
              cast( null as boolean ) as  prior2_mmr_hospice,
              cast( null as string ) as  current_mmr_risk_code_type,
              cast( null as string ) as  prior_mmr_risk_code_type,
              cast( null as string ) as  prior2_mmr_risk_code_type,
              cast( null as string ) as  current_mmr_risk_code_description,
              cast( null as string ) as  prior_mmr_risk_code_description,
              cast( null as string ) as  prior2_mmr_risk_code_description,
              cast( null as boolean ) as  current_is_eligible,
              cast( null as boolean ) as  prior_is_eligible,
              cast( null as boolean ) as  prior2_is_eligible,
              cast( null as date ) as  eligibility_date,
              cast( null as date ) as  eligibility_end_date,
              cast( null as string ) as  current_eligibility_status,
              cast( null as string ) as  prior_eligibility_status,
              cast( null as string ) as  prior2_eligibility_status,
              cast( null as integer ) as  current_num_months_eligible,
              cast( null as integer ) as  prior_num_months_eligible,
              cast( null as integer ) as  prior2_num_months_eligible,
              cast( null as integer ) as  current_recap_count,
              cast( null as integer ) as  prior_recap_count,
              cast( null as integer ) as  prior2_recap_count,
              cast( null as integer ) as  current_recap_opp_count,
              cast( null as integer ) as  prior_recap_opp_count,
              cast( null as integer ) as  prior2_recap_opp_count,
              cast( null as boolean ) as  current_wellness_visit,
              cast( null as boolean ) as  prior_wellness_visit,
              cast( null as boolean ) as  prior2_wellness_visit,
              cast( null as double ) as  current_raf_captured,
              cast( null as double ) as  prior_raf_captured,
              cast( null as double ) as  prior2_raf_captured,
              cast( null as double ) as  current_raf_demo,
              cast( null as double ) as  prior_raf_demo,
              cast( null as double ) as  prior2_raf_demo,
              cast( null as double ) as  current_opportunity,
              cast( null as double ) as  prior_opportunity,
              cast( null as double ) as  prior2_opportunity,
              cast( null as double ) as  current_raf_projected,
              cast( null as double ) as  prior_raf_projected,
              cast( null as double ) as  prior2_raf_projected,
              array(' ',' ')  as  current_hcc_cap,
              array(' ',' ')  as  prior_hcc_cap,
              array(' ',' ')  as  prior2_hcc_cap,
              array(' ',' ')  as  current_hcc_sus,
              array(' ',' ')  as  prior_hcc_sus,
              array(' ',' ')  as  prior2_hcc_sus,
              cast( null as double ) as  current_hcc_captured,
              cast( null as double ) as  prior_hcc_captured,
              cast( null as double ) as  prior2_hcc_captured,
              cast( null as double ) as  current_hcc_captured_source_claim,
              cast( null as double ) as  prior_hcc_captured_source_claim,
              cast( null as double ) as  prior2_hcc_captured_source_claim,
              cast( null as double ) as  current_hcc_captured_source_hra,
              cast( null as double ) as  prior_hcc_captured_source_hra,
              cast( null as double ) as  prior2_hcc_captured_source_hra,
              cast( null as double ) as  current_hcc_captured_source_hra_crr,
              cast( null as double ) as  prior_hcc_captured_source_hra_crr,
              cast( null as double ) as  prior2_hcc_captured_source_hra_crr,
              cast( null as double ) as  current_hcc_captured_source_mor,
              cast( null as double ) as  prior_hcc_captured_source_mor,
              cast( null as double ) as  prior2_hcc_captured_source_mor,
              cast( null as double ) as  current_hcc_captured_source_crr,
              cast( null as double ) as  prior_hcc_captured_source_crr,
              cast( null as double ) as  prior2_hcc_captured_source_crr,
              cast( null as double ) as  current_hcc_captured_source_other,
              cast( null as double ) as  prior_hcc_captured_source_other,
              cast( null as double ) as  prior2_hcc_captured_source_other,
              cast( null as double ) as  current_hcc_captured_new_chronic,
              cast( null as double ) as  prior_hcc_captured_new_chronic,
              cast( null as double ) as  prior2_hcc_captured_new_chronic,
              cast( null as double ) as  current_hcc_captured_yoy_recapture,
              cast( null as double ) as  prior_hcc_captured_yoy_recapture,
              cast( null as double ) as  prior2_hcc_captured_yoy_recapture,
              cast( null as double ) as  current_hcc_captured_mor_new_chronic,
              cast( null as double ) as  prior_hcc_captured_mor_new_chronic,
              cast( null as double ) as  prior2_hcc_captured_mor_new_chronic,
              cast( null as double ) as  current_hcc_captured_mor_yoy_recapture,
              cast( null as double ) as  prior_hcc_captured_mor_yoy_recapture,
              cast( null as double ) as  prior2_hcc_captured_mor_yoy_recapture,
              cast( null as double ) as  current_hcc_captured_acute,
              cast( null as double ) as  prior_hcc_captured_acute,
              cast( null as double ) as  prior2_hcc_captured_acute,
              cast( null as double ) as  current_hcc_captured_other,
              cast( null as double ) as  prior_hcc_captured_other,
              cast( null as double ) as  prior2_hcc_captured_other,
              cast( null as double ) as  current_hcc_suspects_all,
              cast( null as double ) as  prior_hcc_suspects_all,
              cast( null as double ) as  prior2_hcc_suspects_all,
              cast( null as double ) as  current_hcc_suspects_yoy,
              cast( null as double ) as  prior_hcc_suspects_yoy,
              cast( null as double ) as  prior2_hcc_suspects_yoy,
              cast( null as double ) as  current_hcc_suspects_mor_yoy,
              cast( null as double ) as  prior_hcc_suspects_mor_yoy,
              cast( null as double ) as  prior2_hcc_suspects_mor_yoy,
              cast( null as double ) as  current_hcc_suspects_u,
              cast( null as double ) as  prior_hcc_suspects_u,
              cast( null as double ) as  prior2_hcc_suspects_u,
              cast( null as double ) as  current_hcc_suspects_asr,
              cast( null as double ) as  prior_hcc_suspects_asr,
              cast( null as double ) as  prior2_hcc_suspects_asr,
              cast( null as double ) as  current_hcc_suspects_n,
              cast( null as double ) as  prior_hcc_suspects_n,
              cast( null as double ) as  prior2_hcc_suspects_n,
              cast( null as double ) as  current_hcc_suspects_cpt,
              cast( null as double ) as  prior_hcc_suspects_cpt,
              cast( null as double ) as  prior2_hcc_suspects_cpt,
              cast( null as double ) as  current_hcc_suspects_ml,
              cast( null as double ) as  prior_hcc_suspects_ml,
              cast( null as double ) as  prior2_hcc_suspects_ml,
              cast( null as double ) as  current_hcc_suspects_other,
              cast( null as double ) as  prior_hcc_suspects_other,
              cast( null as double ) as  prior2_hcc_suspects_other,
              cast( null as double ) as  current_hcc_suspects_clinical,
              cast( null as double ) as  prior_hcc_suspects_clinical,
              cast( null as double ) as  prior2_hcc_suspects_clinical,
              cast( null as integer ) as  current_hcc_captured_num_all,
              cast( null as integer ) as  prior_hcc_captured_num_all,
              cast( null as integer ) as  prior2_hcc_captured_num_all,
              cast( null as integer ) as  current_hcc_captured_num_source_claim,
              cast( null as integer ) as  prior_hcc_captured_num_source_claim,
              cast( null as integer ) as  prior2_hcc_captured_num_source_claim,
              cast( null as integer ) as  current_hcc_captured_num_source_hra,
              cast( null as integer ) as  prior_hcc_captured_num_source_hra,
              cast( null as integer ) as  prior2_hcc_captured_num_source_hra,
              cast( null as integer ) as  current_hcc_captured_num_source_hra_crr,
              cast( null as integer ) as  prior_hcc_captured_num_source_hra_crr,
              cast( null as integer ) as  prior2_hcc_captured_num_source_hra_crr,
              cast( null as integer ) as  current_hcc_captured_num_source_mor,
              cast( null as integer ) as  prior_hcc_captured_num_source_mor,
              cast( null as integer ) as  prior2_hcc_captured_num_source_mor,
              cast( null as integer ) as  current_hcc_captured_num_source_crr,
              cast( null as integer ) as  prior_hcc_captured_num_source_crr,
              cast( null as integer ) as  prior2_hcc_captured_num_source_crr,
              cast( null as integer ) as  current_hcc_captured_num_source_other,
              cast( null as integer ) as  prior_hcc_captured_num_source_other,
              cast( null as integer ) as  prior2_hcc_captured_num_source_other,
              cast( null as integer ) as  current_hcc_captured_num_new_chronic,
              cast( null as integer ) as  prior_hcc_captured_num_new_chronic,
              cast( null as integer ) as  prior2_hcc_captured_num_new_chronic,
              cast( null as integer ) as  current_hcc_captured_num_yoy_recapture,
              cast( null as integer ) as  prior_hcc_captured_num_yoy_recapture,
              cast( null as integer ) as  prior2_hcc_captured_num_yoy_recapture,
              cast( null as integer ) as  current_hcc_captured_num_mor_new_chronic,
              cast( null as integer ) as  prior_hcc_captured_num_mor_new_chronic,
              cast( null as integer ) as  prior2_hcc_captured_num_mor_new_chronic,
              cast( null as integer ) as  current_hcc_captured_num_mor_yoy_recapture,
              cast( null as integer ) as  prior_hcc_captured_num_mor_yoy_recapture,
              cast( null as integer ) as  prior2_hcc_captured_num_mor_yoy_recapture,
              cast( null as integer ) as  current_hcc_captured_num_acute,
              cast( null as integer ) as  prior_hcc_captured_num_acute,
              cast( null as integer ) as  prior2_hcc_captured_num_acute,
              cast( null as integer ) as  current_hcc_captured_num_other,
              cast( null as integer ) as  prior_hcc_captured_num_other,
              cast( null as integer ) as  prior2_hcc_captured_num_other,
              cast( null as integer ) as  current_hcc_suspects_num_all,
              cast( null as integer ) as  prior_hcc_suspects_num_all,
              cast( null as integer ) as  prior2_hcc_suspects_num_all,
              cast( null as integer ) as  current_hcc_suspects_num_yoy,
              cast( null as integer ) as  prior_hcc_suspects_num_yoy,
              cast( null as integer ) as  prior2_hcc_suspects_num_yoy,
              cast( null as integer ) as  current_hcc_suspects_num_mor_yoy,
              cast( null as integer ) as  prior_hcc_suspects_num_mor_yoy,
              cast( null as integer ) as  prior2_hcc_suspects_num_mor_yoy,
              cast( null as integer ) as  current_hcc_suspects_num_u,
              cast( null as integer ) as  prior_hcc_suspects_num_u,
              cast( null as integer ) as  prior2_hcc_suspects_num_u,
              cast( null as integer ) as  current_hcc_suspects_num_asr,
              cast( null as integer ) as  prior_hcc_suspects_num_asr,
              cast( null as integer ) as  prior2_hcc_suspects_num_asr,
              cast( null as integer ) as  current_hcc_suspects_num_n,
              cast( null as integer ) as  prior_hcc_suspects_num_n,
              cast( null as integer ) as  prior2_hcc_suspects_num_n,
              cast( null as integer ) as  current_hcc_suspects_num_cpt,
              cast( null as integer ) as  prior_hcc_suspects_num_cpt,
              cast( null as integer ) as  prior2_hcc_suspects_num_cpt,
              cast( null as integer ) as  current_hcc_suspects_num_ml,
              cast( null as integer ) as  prior_hcc_suspects_num_ml,
              cast( null as integer ) as  prior2_hcc_suspects_num_ml,
              cast( null as integer ) as  current_hcc_suspects_num_other,
              cast( null as integer ) as  prior_hcc_suspects_num_other,
              cast( null as integer ) as  prior2_hcc_suspects_num_other,
              cast( null as integer ) as  current_hcc_suspects_num_clinical,
              cast( null as integer ) as  prior_hcc_suspects_num_clinical,
              cast( null as integer ) as  prior2_hcc_suspects_num_clinical,
              cast( null as double ) as  current_raf_profitability,
              cast( null as double ) as  prior_raf_profitability,
              cast( null as double ) as  prior2_raf_profitability,
              cast( null as boolean ) as  current_dual,
              cast( null as boolean ) as  current_dual_opp,
              cast( null as boolean ) as  prior_dual,
              cast( null as boolean ) as  prior_dual_opp,
              cast( null as boolean ) as  prior2_dual,
              cast( null as boolean ) as  prior2_dual_opp,
              cast( null as double ) as  current_dual_opp_score,
              cast( null as double ) as  prior_dual_opp_score,
              cast( null as double ) as  prior2_dual_opp_score,
              cast( null as double ) as  current_raf_captured_cf,
              cast( null as double ) as  prior_raf_captured_cf,
              cast( null as double ) as  prior2_raf_captured_cf,
              cast( null as double ) as  current_raf_dual_boost,
              cast( null as double ) as  prior_raf_dual_boost,
              cast( null as double ) as  prior2_raf_dual_boost,
              cast( null as double ) as  current_cf_profitability,
              cast( null as double ) as  prior_cf_profitability,
              cast( null as double ) as  prior2_cf_profitability,
              cast( null as double ) as  current_parta_ramra_pa,
              cast( null as double ) as  prior_parta_ramra_pa,
              cast( null as double ) as  prior2_parta_ramra_pa,
              cast( null as double ) as  current_partb_ramra_pa,
              cast( null as double ) as  prior_partb_ramra_pa,
              cast( null as double ) as  prior2_partb_ramra_pa,
              cast( null as boolean ) as  current_hra_completed,
              cast( null as boolean ) as  prior_hra_completed,
              cast( null as boolean ) as  prior2_hra_completed
          FROM  previous_load a
          LEFT JOIN  member_index_full  b on a.member_id = b.member_id
          WHERE b.member_id is null ),
      update_rows as (
          SELECT
             a.hash_value,
             'UPDATE' as operation,
             a.job_id,
              a.member_id,
              a.hicn,
              a.mbi,
              a.external_member_id,
              a.full_name,
              a.first_name,
              a.last_name,
              a.date_of_birth,
              a.age,
              a.gender,
              a.address_line_1,
              a.address_line_2,
              a.city,
              a.state,
              a.zip,
              a.phone,
              a.program,
              a.health_plan_member_id,
              a.health_plan_name,
              a.chart_delivered_count,
              a.flex1,
              a.flex2,
              a.flex3,
              a.flex4,
              a.flex5,
              a.flex6,
              a.flex7,
              a.flex8,
              a.flex9,
              a.flex10,
              a.pcp_provider_id,
              a.pcp_name,
              a.pcp_npi,
              a.pcp_tax_id,
              a.pcp_flex1,
              a.pcp_flex2,
              a.pcp_flex3,
              a.pcp_flex4,
              a.pcp_flex5,
              a.pcp_flex6,
              a.pcp_flex7,
              a.pcp_flex8,
              a.pcp_flex9,
              a.pcp_flex10,
              a.provider_info,
              a.last_encounter,
              a.pcp_last_encounter,
              a.spec_last_encounter,
              a.current_dos_count,
              a.current_pcp_dos_count,
              a.prior_dos_count,
              a.prior_pcp_dos_count,
              a.prior2_dos_count,
              a.prior2_pcp_dos_count,
              a.encountered_ids,
              a.current_mmr_esrd,
              a.prior_mmr_esrd,
              a.prior2_mmr_esrd,
              a.current_mmr_hospice,
              a.prior_mmr_hospice,
              a.prior2_mmr_hospice,
              a.current_mmr_risk_code_type,
              a.prior_mmr_risk_code_type,
              a.prior2_mmr_risk_code_type,
              a.current_mmr_risk_code_description,
              a.prior_mmr_risk_code_description,
              a.prior2_mmr_risk_code_description,
              a.current_is_eligible,
              a.prior_is_eligible,
              a.prior2_is_eligible,
              a.eligibility_date,
              a.eligibility_end_date,
              a.current_eligibility_status,
              a.prior_eligibility_status,
              a.prior2_eligibility_status,
              a.current_num_months_eligible,
              a.prior_num_months_eligible,
              a.prior2_num_months_eligible,
              a.current_recap_count,
              a.prior_recap_count,
              a.prior2_recap_count,
              a.current_recap_opp_count,
              a.prior_recap_opp_count,
              a.prior2_recap_opp_count,
              a.current_wellness_visit,
              a.prior_wellness_visit,
              a.prior2_wellness_visit,
              a.current_raf_captured,
              a.prior_raf_captured,
              a.prior2_raf_captured,
              a.current_raf_demo,
              a.prior_raf_demo,
              a.prior2_raf_demo,
              a.current_opportunity,
              a.prior_opportunity,
              a.prior2_opportunity,
              a.current_raf_projected,
              a.prior_raf_projected,
              a.prior2_raf_projected,
              a.current_hcc_cap,
              a.prior_hcc_cap,
              a.prior2_hcc_cap,
              a.current_hcc_sus,
              a.prior_hcc_sus,
              a.prior2_hcc_sus,
              a.current_hcc_captured,
              a.prior_hcc_captured,
              a.prior2_hcc_captured,
              a.current_hcc_captured_source_claim,
              a.prior_hcc_captured_source_claim,
              a.prior2_hcc_captured_source_claim,
              a.current_hcc_captured_source_hra,
              a.prior_hcc_captured_source_hra,
              a.prior2_hcc_captured_source_hra,
              a.current_hcc_captured_source_hra_crr,
              a.prior_hcc_captured_source_hra_crr,
              a.prior2_hcc_captured_source_hra_crr,
              a.current_hcc_captured_source_mor,
              a.prior_hcc_captured_source_mor,
              a.prior2_hcc_captured_source_mor,
              a.current_hcc_captured_source_crr,
              a.prior_hcc_captured_source_crr,
              a.prior2_hcc_captured_source_crr,
              a.current_hcc_captured_source_other,
              a.prior_hcc_captured_source_other,
              a.prior2_hcc_captured_source_other,
              a.current_hcc_captured_new_chronic,
              a.prior_hcc_captured_new_chronic,
              a.prior2_hcc_captured_new_chronic,
              a.current_hcc_captured_yoy_recapture,
              a.prior_hcc_captured_yoy_recapture,
              a.prior2_hcc_captured_yoy_recapture,
              a.current_hcc_captured_mor_new_chronic,
              a.prior_hcc_captured_mor_new_chronic,
              a.prior2_hcc_captured_mor_new_chronic,
              a.current_hcc_captured_mor_yoy_recapture,
              a.prior_hcc_captured_mor_yoy_recapture,
              a.prior2_hcc_captured_mor_yoy_recapture,
              a.current_hcc_captured_acute,
              a.prior_hcc_captured_acute,
              a.prior2_hcc_captured_acute,
              a.current_hcc_captured_other,
              a.prior_hcc_captured_other,
              a.prior2_hcc_captured_other,
              a.current_hcc_suspects_all,
              a.prior_hcc_suspects_all,
              a.prior2_hcc_suspects_all,
              a.current_hcc_suspects_yoy,
              a.prior_hcc_suspects_yoy,
              a.prior2_hcc_suspects_yoy,
              a.current_hcc_suspects_mor_yoy,
              a.prior_hcc_suspects_mor_yoy,
              a.prior2_hcc_suspects_mor_yoy,
              a.current_hcc_suspects_u,
              a.prior_hcc_suspects_u,
              a.prior2_hcc_suspects_u,
              a.current_hcc_suspects_asr,
              a.prior_hcc_suspects_asr,
              a.prior2_hcc_suspects_asr,
              a.current_hcc_suspects_n,
              a.prior_hcc_suspects_n,
              a.prior2_hcc_suspects_n,
              a.current_hcc_suspects_cpt,
              a.prior_hcc_suspects_cpt,
              a.prior2_hcc_suspects_cpt,
              a.current_hcc_suspects_ml,
              a.prior_hcc_suspects_ml,
              a.prior2_hcc_suspects_ml,
              a.current_hcc_suspects_other,
              a.prior_hcc_suspects_other,
              a.prior2_hcc_suspects_other,
              a.current_hcc_suspects_clinical,
              a.prior_hcc_suspects_clinical,
              a.prior2_hcc_suspects_clinical,
              a.current_hcc_captured_num_all,
              a.prior_hcc_captured_num_all,
              a.prior2_hcc_captured_num_all,
              a.current_hcc_captured_num_source_claim,
              a.prior_hcc_captured_num_source_claim,
              a.prior2_hcc_captured_num_source_claim,
              a.current_hcc_captured_num_source_hra,
              a.prior_hcc_captured_num_source_hra,
              a.prior2_hcc_captured_num_source_hra,
              a.current_hcc_captured_num_source_hra_crr,
              a.prior_hcc_captured_num_source_hra_crr,
              a.prior2_hcc_captured_num_source_hra_crr,
              a.current_hcc_captured_num_source_mor,
              a.prior_hcc_captured_num_source_mor,
              a.prior2_hcc_captured_num_source_mor,
              a.current_hcc_captured_num_source_crr,
              a.prior_hcc_captured_num_source_crr,
              a.prior2_hcc_captured_num_source_crr,
              a.current_hcc_captured_num_source_other,
              a.prior_hcc_captured_num_source_other,
              a.prior2_hcc_captured_num_source_other,
              a.current_hcc_captured_num_new_chronic,
              a.prior_hcc_captured_num_new_chronic,
              a.prior2_hcc_captured_num_new_chronic,
              a.current_hcc_captured_num_yoy_recapture,
              a.prior_hcc_captured_num_yoy_recapture,
              a.prior2_hcc_captured_num_yoy_recapture,
              a.current_hcc_captured_num_mor_new_chronic,
              a.prior_hcc_captured_num_mor_new_chronic,
              a.prior2_hcc_captured_num_mor_new_chronic,
              a.current_hcc_captured_num_mor_yoy_recapture,
              a.prior_hcc_captured_num_mor_yoy_recapture,
              a.prior2_hcc_captured_num_mor_yoy_recapture,
              a.current_hcc_captured_num_acute,
              a.prior_hcc_captured_num_acute,
              a.prior2_hcc_captured_num_acute,
              a.current_hcc_captured_num_other,
              a.prior_hcc_captured_num_other,
              a.prior2_hcc_captured_num_other,
              a.current_hcc_suspects_num_all,
              a.prior_hcc_suspects_num_all,
              a.prior2_hcc_suspects_num_all,
              a.current_hcc_suspects_num_yoy,
              a.prior_hcc_suspects_num_yoy,
              a.prior2_hcc_suspects_num_yoy,
              a.current_hcc_suspects_num_mor_yoy,
              a.prior_hcc_suspects_num_mor_yoy,
              a.prior2_hcc_suspects_num_mor_yoy,
              a.current_hcc_suspects_num_u,
              a.prior_hcc_suspects_num_u,
              a.prior2_hcc_suspects_num_u,
              a.current_hcc_suspects_num_asr,
              a.prior_hcc_suspects_num_asr,
              a.prior2_hcc_suspects_num_asr,
              a.current_hcc_suspects_num_n,
              a.prior_hcc_suspects_num_n,
              a.prior2_hcc_suspects_num_n,
              a.current_hcc_suspects_num_cpt,
              a.prior_hcc_suspects_num_cpt,
              a.prior2_hcc_suspects_num_cpt,
              a.current_hcc_suspects_num_ml,
              a.prior_hcc_suspects_num_ml,
              a.prior2_hcc_suspects_num_ml,
              a.current_hcc_suspects_num_other,
              a.prior_hcc_suspects_num_other,
              a.prior2_hcc_suspects_num_other,
              a.current_hcc_suspects_num_clinical,
              a.prior_hcc_suspects_num_clinical,
              a.prior2_hcc_suspects_num_clinical,
              a.current_raf_profitability,
              a.prior_raf_profitability,
              a.prior2_raf_profitability,
              a.current_dual,
              a.current_dual_opp,
              a.prior_dual,
              a.prior_dual_opp,
              a.prior2_dual,
              a.prior2_dual_opp,
              a.current_dual_opp_score,
              a.prior_dual_opp_score,
              a.prior2_dual_opp_score,
              a.current_raf_captured_cf,
              a.prior_raf_captured_cf,
              a.prior2_raf_captured_cf,
              a.current_raf_dual_boost,
              a.prior_raf_dual_boost,
              a.prior2_raf_dual_boost,
              a.current_cf_profitability,
              a.prior_cf_profitability,
              a.prior2_cf_profitability,
              a.current_parta_ramra_pa,
              a.prior_parta_ramra_pa,
              a.prior2_parta_ramra_pa,
              a.current_partb_ramra_pa,
              a.prior_partb_ramra_pa,
              a.prior2_partb_ramra_pa,
              a.current_hra_completed,
              a.prior_hra_completed,
              a.prior2_hra_completed
           FROM   member_index_full  a
           INNER JOIN previous_load b on a.member_id = b.member_id 
           WHERE a.hash_value <> b.hash_value )
      SELECT *
      FROM new_rows
      UNION
      SELECT *
      FROM delete_rows
      UNION
      SELECT *
      FROM update_rows

# Note: Load tables have to be same as Extract tables.
Load:
  member_index_full:
    load_1:
      type: parquet
      location: '{aggr_location}/member_index_full'
      mode: overwrite

  member_index_incremental:
    load_1:
      type: parquet
      location: '{project_root_path}/{client}/sync/member_index_incremental'
      mode: overwrite
#    load_to_postgres:
#      type: postgres
#      conn_config_name: epia_medicare_postgres
#      table_name: load_member_index
#      mode: overwrite
(function(){"use strict";window.RBSeverity={};RBSeverity.CommentDialogHookView=Backbone.View.extend({events:{"click .buttons .save-major":"_onSaveMajorClicked","click .buttons .save-minor":"_onSaveMinorClicked","click .buttons .save-info":"_onSaveInfoClicked"},buttonsTemplate:_.template('<span class="severity-actions">\n  <input type="button" class="save-major" value="Major"\n         disabled="true" />\n  <input type="button" class="save-minor" value="Minor"\n         disabled="true" />\n  <input type="button" class="save-info" value="Info"\n         disabled="true" />\n</span>'),initialize:function initialize(options){this.commentDialog=options.commentDialog;this.commentEditor=options.commentEditor},render:function render(){var $severityButtons=$(this.buttonsTemplate());this.commentDialog.$saveButton.remove();this.commentDialog.$buttons.prepend($severityButtons);$severityButtons.find("input").bindVisibility(this.commentEditor,"canEdit").bindProperty("disabled",this.commentEditor,"canSave",{elementToModel:false,inverse:true});this.commentEditor.setExtraData("severity","info")},_onSaveMajorClicked:function _onSaveMajorClicked(){this._saveCommon("major")},_onSaveMinorClicked:function _onSaveMinorClicked(){this._saveCommon("minor")},_onSaveInfoClicked:function _onSaveInfoClicked(){this._saveCommon("info")},_saveCommon:function _saveCommon(severity){if(this.commentEditor.get("canSave")){this.commentEditor.setExtraData("severity",severity);this.commentDialog.save()}}});RBSeverity.ReviewDialogCommentHookView=Backbone.View.extend({events:{"change select":"_onSeverityChanged"},template:_.template('<label for="<%- id %>">Severity:</label>\n<select id="<%- id %>">\n <option value="major">Major</option>\n <option value="minor">Minor</option>\n <option value="info">Info</option>\n</select>'),render:function render(){var severity=this.model.get("extraData").severity;this.$el.html(this.template({id:"severity_"+this.model.id}));this._$select=this.$("select");if(severity){this._$select.val(severity)}else{this._$select.prepend($("<option selected/>"))}return this},_onSeverityChanged:function _onSeverityChanged(){this.model.get("extraData").severity=this._$select.val();this.model.save()}});RBSeverity.Extension=RB.Extension.extend({initialize:function initialize(){RB.Extension.prototype.initialize.call(this);new RB.CommentDialogHook({extension:this,viewType:RBSeverity.CommentDialogHookView});new RB.ReviewDialogCommentHook({extension:this,viewType:RBSeverity.ReviewDialogCommentHookView})}})}).call(this);

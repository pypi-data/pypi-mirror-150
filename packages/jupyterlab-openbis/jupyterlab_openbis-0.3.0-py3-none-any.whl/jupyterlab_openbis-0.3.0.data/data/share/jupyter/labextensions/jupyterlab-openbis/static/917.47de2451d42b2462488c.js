/*! For license information please see 917.47de2451d42b2462488c.js.LICENSE.txt */
(self.webpackChunkjupyterlab_openbis=self.webpackChunkjupyterlab_openbis||[]).push([[917],{917:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ButtonExtension:()=>nt,default:()=>at});var a=n(129),s=n(441),o=n(245),c=n(271),l=n.n(c);const r=({className:e,children:t,columns:n=[],headDisabled:a=!1})=>l().createElement("table",{className:e},!a&&l().createElement("thead",null,l().createElement("tr",null,n.map(((e,t)=>l().createElement("th",{key:t},e))))),l().createElement("tbody",null,t)),i=e=>c.createElement("tr",null,c.Children.map(e.children,((t,n)=>c.createElement("td",{key:n,className:e.growIndex===n?"wide":""},t)))),d={name:"",url:"",user:"",password:"",error:""},u={connections:[],workingDir:"",defaultWorkingDir:"",proposedConnection:d,errors:[],selected:-1},p={},m=(0,c.createContext)([u,null]);class h{constructor(e,t){this.key=e,this.value=t}}class w{constructor(e){this.index=e}}class E{constructor(e,t,n){this.index=e,this.key=t,this.value=n}}class f{constructor(e,t,n){this.connections=e,this.notebook_dir=t,this.selected=n}}class v{constructor(e){this.error=e}}class g{constructor(e){this.selected=e}}class y{}class b{constructor(e){this.name=e}}class I{constructor(e){this.message=e}}class C{constructor(e){this.index=e}}class x{constructor(e){this.index=e}}class D{constructor(e){this.index=e}}class N{constructor(e){this.index=e}}class S{constructor(e,t){this.index=e,this.message=t}}class k{constructor(e){this.value=e}}class T{}function P(e){return""===e.name||""===e.url||""===e.user||""===e.password}const A=e=>{const[t,n]=(0,c.useContext)(m),a=t.proposedConnection,s=e=>t=>{t.stopPropagation(),"Enter"!==t.key||P(e)||n(new y)};return l().createElement(r,{columns:["Name","URL","Username","Password"],className:"openbis-table openbis-connection-creation"},l().createElement(i,null,l().createElement("input",{type:"text",placeholder:"openBIS instance name",value:a.name,onChange:e=>n(new h("name",e.target.value)),onKeyDown:s(a)}),l().createElement("input",{type:"text",placeholder:"https://openbis.domain:port",value:a.url,onChange:e=>n(new h("url",e.target.value)),onKeyDown:s(a)}),l().createElement("input",{type:"text",placeholder:"username",value:a.user,onChange:e=>n(new h("user",e.target.value)),onKeyDown:s(a)}),l().createElement("input",{type:"password",placeholder:"password",value:a.password,onChange:e=>n(new h("password",e.target.value)),onKeyDown:s(a)})),l().createElement(i,null,l().createElement("div",null),l().createElement("div",null),l().createElement("div",{className:"openbis-flex-vertical"},l().createElement("span",{className:"openbis-error"},a.error)),l().createElement("div",{className:"openbis-flex-vertical"},l().createElement("button",{disabled:P(a),onClick:()=>n(new y)},"Create"))))},R=e=>{const[t,n]=(0,c.useContext)(m);return l().createElement(r,{className:"openbis-table openbis-working-directory"},l().createElement(i,null,l().createElement("div",{className:"openbis-flex-vertical"},l().createElement("input",{className:"openbis-working-directory",type:"text",placeholder:"Working directory",value:t.workingDir,onChange:e=>n(new k(e.target.value))})),l().createElement("a",{href:"#",className:"openbis-link",onClick:()=>n(new T)},"Reset to default")))},O=e=>0===e.username.length||0===e.password.length,B=e=>{const[t,n]=(0,c.useContext)(m),a=e=>a=>{a.stopPropagation(),"Enter"!==a.key||O(t.connections[e])||n(new C(e))};return l().createElement(r,{columns:["","Name","URL","Status","Credentials"],className:"openbis-table openbis-table-bordered openbis-table-striped openbis-connection-list"},t.connections.map(((e,s)=>l().createElement(i,{key:s},l().createElement("input",{type:"radio",name:"connection",checked:t.selected===s,onChange:()=>n(new w(s))}),l().createElement("div",{className:"openbis-flex-vertical"},l().createElement("span",null,e.name)),l().createElement("div",{className:"openbis-flex-vertical"},l().createElement("span",null,e.url)),l().createElement("div",{className:"openbis-flex-vertical"},function(e){const t="connected"===e.status?"openbis-connection-status-connected":"openbis-connection-status-not-connected";return l().createElement("span",{className:t}," ",e.status," ")}(e),""!==t.errors[s]&&l().createElement("span",{className:"openbis-error"},t.errors[s])),l().createElement("div",{className:"openbis-flex-vertical"},l().createElement("input",{type:"text",placeholder:"username",value:e.username,onChange:e=>n(new E(s,"user",e.target.value)),onKeyDown:a(s)}),l().createElement("input",{type:"password",placeholder:"password",value:e.password,onChange:e=>n(new E(s,"password",e.target.value)),onKeyDown:a(s)}),l().createElement("div",{className:"openbis-flex-horizontal"},l().createElement("button",{className:"connect-button",onClick:()=>n(new C(s)),disabled:O(e)},"Connect"),l().createElement("button",{className:"delete-button",onClick:()=>n(new x(s))},"Delete")))))))},U=e=>{const[t,n]=(0,c.useContext)(m);return l().createElement("div",{className:"openbis-flex-vertical"},0!==t.connections.length&&l().createElement(l().Fragment,null,l().createElement("div",{className:"openbis-connection-dialog-header"},"Choose connection"),l().createElement(B,null)),l().createElement("div",{className:"openbis-connection-dialog-header"},"Create new connection"),l().createElement(A,null),l().createElement("div",{className:"openbis-connection-dialog-header"},"Your working directory"),l().createElement(R,null))};class _{constructor(e){this.panelId=e}}class F{constructor(e){this.panelId=e}}class j extends s.ReactWidget{constructor(e){super(),this.setDispatch=e=>this.dispatch=e,this.getDispatch=()=>this.dispatch,this.panel=e}onAfterAttach(e){super.onAfterAttach(e)}getValue(){this.dispatch(new F(this.panel.id))}onBeforeDetach(e){super.onBeforeDetach(e)}}var M;!function(e){e[e.ERROR=0]="ERROR",e[e.INFO=1]="INFO",e[e.SUCCESS=2]="SUCCESS"}(M||(M={}));const K={value:"",message:"",messageType:M.INFO};function z(e,t,n,...a){return s=>{const o=e=>setTimeout((()=>n()(e)));a.forEach((t=>t(o)(e)(s))),t(s)}}var L=n(715);const Q=(0,L.produce)(((e,t)=>{if(t instanceof f&&(e.connections=t.connections,e.defaultWorkingDir=t.notebook_dir,""===e.workingDir&&(e.workingDir=e.defaultWorkingDir),null!=t.selected&&(e.selected=e.connections.findIndex((e=>e.name===t.selected)))),t instanceof h){const{key:n,value:a}=t;"name"===n?e.proposedConnection.name=a:"url"===n?e.proposedConnection.url=a:"user"===n?e.proposedConnection.user=a:"password"===n&&(e.proposedConnection.password=a),e.proposedConnection.error=""}if(t instanceof E){const{key:n,index:a,value:s}=t;"user"===n?e.connections[a].username=s:"password"===n&&(e.connections[a].password=s),e.errors[a]=""}t instanceof b&&(e.proposedConnection=d),t instanceof I&&(e.proposedConnection.error=t.message),t instanceof S&&(e.errors[t.index]=t.message),t instanceof N&&(e.errors[t.index]=""),t instanceof w&&(e.selected=t.index),t instanceof k&&(e.workingDir=t.value),t instanceof T&&(e.workingDir=e.defaultWorkingDir)}));var W,V=n(290);!function(e){e.GET="GET",e.PUT="PUT",e.POST="POST",e.DELETE="DELETE"}(W||(W={}));class H{constructor(e,t,n,a,s){this.url=e,this.method=t,this.body=n,this.onSuccess=a,this.onError=s}}class $ extends H{constructor(e,t,n){super(e,W.GET,null,t,n)}}class G extends H{constructor(e,t,n,a){super(e,W.PUT,t,n,a)}}class J extends H{constructor(e,t,n,a){super(e,W.POST,t,n,a)}}class q extends H{constructor(e,t,n){super(e,W.DELETE,null,t,n)}}const Y=e=>t=>t=>{if(t instanceof H){const{url:n,method:a,onSuccess:s,onError:o}=t,c=V.ServerConnection.makeSettings(),l=c.baseUrl+n,r={method:a,body:t.body},i=V.ServerConnection.makeRequest(l,r,c),d=i.then((e=>"DELETE"===r.method?Promise.resolve({}):e.json()));Promise.all([i,d]).then((([t,n])=>e(s(t.status,n)))).catch((t=>e(o(t))))}},X=e=>t=>n=>{if(n instanceof g&&e(new $("openbis/conns",((e,t)=>new f(t.connections,t.notebook_dir,n.selected)),(e=>new v(e)))),n instanceof y&&e(new J("openbis/conns",JSON.stringify({name:t.proposedConnection.name,url:t.proposedConnection.url,username:t.proposedConnection.user,password:t.proposedConnection.password}),((e,n)=>200===e?new b(t.proposedConnection.name):new I("Connection error")),(e=>new I("Connection error")))),n instanceof b&&e(new g(n.name)),n instanceof x&&e(new q("openbis/conn/"+t.connections[n.index].name,((e,t)=>new D(n.index)),(e=>new g(null)))),n instanceof D&&(t.selected===n.index?e(new w(-1)):t.selected>n.index&&e(new w(t.selected-1)),e(new g(null))),n instanceof C){const a=t.connections[n.index];e(new G("openbis/conn/"+a.name,JSON.stringify({username:a.username,password:a.password}),((e,t)=>200===e?new N(n.index):new S(n.index,401===e?"Username / password incorrect":"Connection error")),(e=>new S(n.index,"Connection error"))))}n instanceof N&&e(new g(null)),n instanceof F&&(p[n.panelId]=t)},Z=e=>{const[t,n]=(0,c.useReducer)(Q,e.initialState),a=z(t,n,e.getDispatch,Y,X);return(0,c.useLayoutEffect)((()=>{e.setDispatch(a)})),(0,c.useEffect)((()=>{e.getDispatch()(new g(null))}),[]),l().createElement(m.Provider,{value:[t,a]},e.children)};class ee extends j{constructor(e){super(e),this.panel.id in p||(p[this.panel.id]=u)}render(){return c.createElement(Z,{id:this.panel.id,initialState:p[this.panel.id],setDispatch:this.setDispatch,getDispatch:this.getDispatch},c.createElement(U,null))}}const te={error:"",connection:null,downloadPath:K,defaultDownloadPath:"",entityId:K,activeEntityId:"",dataSetId:K,result:null,selected:[],downloadQueue:[],panel:null,downloadingActive:!0},ne={},ae=(0,c.createContext)([te,null]);class se{constructor(e){this.value=e}}class oe{constructor(e){this.value=e}}class ce{constructor(e){this.value=e}}class le{}class re{constructor(e){this.result=e}}class ie{}class de{constructor(e){this.permId=e}}class ue{constructor(e){this.permId=e}}class pe{}class me{}class he{}class we{}class Ee{}class fe{constructor(e,t,n){this.permId=e,this.data=t,this.success=n}}class ve{constructor(e,t,n){this.permId=e,this.data=t,this.success=n}}const ge=e=>{const{updateAction:t,commandAction:n,placeholder:a,field:s,disabled:o}=e,[r,i]=(0,c.useContext)(e.context),{value:d,message:u,messageType:p}=s(r),m=p===M.ERROR?"message-error":p===M.SUCCESS?"message-success":"message-info";return l().createElement("div",{className:"input"},l().createElement("input",{type:"text",placeholder:a,value:d,onChange:e=>i(t(e.target.value)),onKeyDown:e=>{e.stopPropagation(),"Enter"===e.key&&null!=n&&o(r,d)&&i(new n)}}),l().createElement("div",{className:m},u))};ge.defaultProps={placeholder:"",disabled:(e,t)=>!1};const ye=e=>{const{commandAction:t,isActive:n}=e,[a,s]=(0,c.useContext)(e.context);return l().createElement("button",{disabled:!n,onClick:()=>s(new t)},e.children)};var be=n(184),Ie=n.n(be);const Ce=e=>{const[t,n]=(0,c.useContext)(ae);if(null==t.result||0===t.result.totalCount)return null;const{start_with:a,count:s,totalCount:o}=t.result,d=Ie()("position","link",{disabled:0===a,"not-visible":o<=5}),u=Ie()("position","link",{disabled:a+s>=o,"not-visible":o<=5}),p=Ie()("position",{"not-visible":o<=5}),m=t.downloadQueue.length>0?"Downloading ("+(t.selected.length-t.downloadQueue.length+1)+"/"+t.selected.length+")":t.selected.length+" datasets selected";return l().createElement("div",{className:"browser"},l().createElement(r,{columns:["","permId","Name","Type","Registration date","Status","Size"],className:"openbis-table openbis-table-bordered openbis-table-striped"},t.result.dataSets.map(((e,a)=>l().createElement(i,{key:a},l().createElement("input",{type:"checkbox",checked:t.selected.includes(e.permId),onChange:t=>n(t.target.checked?new de(e.permId):new ue(e.permId))}),l().createElement("div",null,e.permId),l().createElement("div",null,e.$NAME),l().createElement("div",null,e.type),l().createElement("div",null,e.registrationDate),l().createElement("div",null,e.status),l().createElement("div",null,e.size))))),l().createElement("div",{className:"footer"},l().createElement("div",{className:d,onClick:()=>n(new me)},"<<  "),l().createElement("div",{className:p},`${t.result.start_with+1}-${t.result.start_with+t.result.count}/${t.result.totalCount}`),l().createElement("div",{className:u,onClick:()=>n(new pe)}," >>"),l().createElement("div",{className:"message"},m),l().createElement(ye,{context:ae,isActive:""===t.error&&t.selected.length>0&&t.downloadingActive,commandAction:we},"Download selected")))},xe=e=>{const[t,n]=(0,c.useContext)(ae);return l().createElement("div",{id:"jupyterlab-openbis-download-dialog",className:"jupyterlab-openbis-dialog"},""!==t.error&&l().createElement("div",{className:"main-error"},t.error),""===t.error&&null!=t.connection&&l().createElement("div",{className:"main-info"},"Connected to openBIS '",t.connection.name,"' (",t.connection.url,")"),l().createElement("div",{className:"row"},l().createElement("div",{className:"label"},"Entity identifier / permId"),l().createElement(ge,{context:ae,updateAction:e=>new se(e),commandAction:le,placeholder:"Sample or experiment identifier / permId",field:e=>e.entityId,disabled:(e,t)=>""===e.error&&""!==t}),l().createElement(ye,{context:ae,isActive:""===t.error&&""!==t.entityId.value,commandAction:le},"Show datasets")),l().createElement(Ce,null),l().createElement("div",{className:"row"},l().createElement("div",{className:"label"},"Enter dataset permId directly"),l().createElement(ge,{context:ae,updateAction:e=>new oe(e),commandAction:he,placeholder:"Dataset permId",field:e=>e.dataSetId,disabled:(e,t)=>""===e.error&&""!==t}),l().createElement(ye,{context:ae,isActive:""===t.error&&""!==t.dataSetId.value&&t.downloadingActive,commandAction:he},"Download")),l().createElement("div",{className:"row"},l().createElement("div",{className:"label"},"Download data to path"),l().createElement(ge,{context:ae,updateAction:e=>new ce(e),field:e=>e.downloadPath})))},De=(0,L.produce)(((e,t)=>{if(t instanceof _){const n=t.panelId;if(n in p){const{selected:t,connections:a,workingDir:s}=p[n];if(e.defaultDownloadPath!==s&&(e.downloadPath.value=s,e.defaultDownloadPath=s),t in a){const n=a[t];e.connection&&n.name!==e.connection.name&&(e.dataSetId=K,e.downloadPath=K,e.entityId=K,e.result=null,e.selected=[]),"connected"!==n.status?e.error="Please authenticate the selected connection":e.error="",e.connection=n}else e.error="Please select a connection"}else e.error="Please select a connection"}t instanceof se&&(e.entityId.value=t.value,e.entityId.message=""),t instanceof oe&&(e.dataSetId.value=t.value,e.dataSetId.message=""),t instanceof ce&&(e.downloadPath.value=t.value,e.downloadPath.message=""),t instanceof le&&(e.selected=[],e.entityId.message=""),t instanceof re&&(e.result=t.result,e.result.count=Number(e.result.count),e.result.start_with=Number(e.result.start_with),0===t.result.totalCount&&(e.entityId.message="No datasets found",e.entityId.messageType=M.ERROR),e.activeEntityId=e.entityId.value),(t instanceof pe||t instanceof me)&&(e.entityId.value=e.activeEntityId),t instanceof de&&e.selected.push(t.permId),t instanceof ue&&(e.selected=e.selected.filter((e=>e!==t.permId))),t instanceof we&&(e.downloadQueue=e.selected,e.downloadingActive=!1),t instanceof fe&&(t.success?e.downloadQueue=e.downloadQueue.filter((e=>e!==t.permId)):e.downloadQueue=[],0===e.downloadQueue.length&&(e.downloadingActive=!0)),t instanceof he&&(e.dataSetId.message="Downloading "+e.dataSetId.value,e.dataSetId.messageType=M.INFO,e.downloadingActive=!1),t instanceof ve&&(t.success?(e.dataSetId.message="Download of "+t.permId+" complete",e.dataSetId.messageType=M.INFO):(e.dataSetId.message="Dataset "+t.permId+" not found",e.dataSetId.messageType=M.ERROR),e.downloadingActive=!0)}));function Ne(e,t,n){const a=t<=0?0:t+5>e.result.totalCount?e.result.totalCount-5:t;return new $("openbis/sample/"+e.connection.name+"/"+encodeURIComponent(n)+"?start_with="+a+"&count=5",((e,t)=>new re(t)),(e=>new ie))}const Se=e=>t=>n=>{if(n instanceof F&&(ne[n.panelId]=t),n instanceof le&&e(Ne(t,0,t.entityId.value)),n instanceof pe&&e(Ne(t,t.result.start_with+5,t.activeEntityId)),n instanceof me&&e(Ne(t,t.result.start_with-5,t.activeEntityId)),n instanceof we&&e(new Ee),n instanceof he){const n=t.dataSetId.value,a=t.downloadPath.value,s="openbis/dataset/"+t.connection.name+"/"+n+"/"+encodeURIComponent(a);e(new $(s,((e,t)=>new ve(n,t,200===e)),(e=>new ve(n,e,!1))))}if(n instanceof Ee){const n=t.downloadQueue[0],a=t.downloadPath.value,s="openbis/dataset/"+t.connection.name+"/"+n+"/"+encodeURIComponent(a);e(new $(s,((e,t)=>new fe(n,t,200===e)),(e=>new fe(n,e,!1))))}(n instanceof fe||n instanceof ve)&&(n.success&&(t.panel.model.metadata.keys().includes("datasets")||t.panel.model.metadata.set("datasets",{}),t.panel.model.metadata.get("datasets")[n.data.permId]=n.data,t.panel.model.dirty=!0),t.downloadQueue.filter((e=>e!==n.permId)).length>0&&e(new Ee))},ke=e=>{const[t,n]=(0,c.useReducer)(De,e.initialState),a=z(t,n,e.getDispatch,Y,Se);return(0,c.useLayoutEffect)((()=>{e.setDispatch(a)})),(0,c.useEffect)((()=>{e.getDispatch()(new _(e.id))}),[]),l().createElement(ae.Provider,{value:[t,a]},e.children)};class Te extends j{constructor(e){super(e),this.panel.id in ne||(ne[this.panel.id]=te,ne[this.panel.id].panel=this.panel)}render(){return c.createElement(ke,{id:this.panel.id,initialState:ne[this.panel.id],setDispatch:this.setDispatch,getDispatch:this.getDispatch},c.createElement(xe,null))}}const Pe={error:"",connection:null,dataSetTypes:[],dataSetType:null,properties:{},targetEntity:K,currentDirectory:null,currentDirectoryContent:[],selectedDataSets:[],selectedFiles:[],uploadInProgress:!1,uploadMessage:"",panel:null},Ae={},Re=(0,c.createContext)([Pe,null]);class Oe{}class Be{constructor(e,t){this.dataSetTypes=e,this.success=t}}class Ue{constructor(e){this.code=e}}class _e{constructor(e,t){this.code=e,this.value=t}}class Fe{constructor(e){this.value=e}}class je{constructor(e){this.permId=e}}class Me{constructor(e){this.permId=e}}class Ke{constructor(e){this.path=e}}class ze{constructor(e){this.path=e}}class Le{constructor(e){this.path=e}}class Qe{constructor(e,t){this.entries=e,this.success=t}}class We{}class Ve{}class He{constructor(e,t){this.value=e,this.success=t}}const $e=l().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",viewBox:"0 0 24 24"},l().createElement("path",{fill:"#616161",d:"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"})),Ge=l().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",viewBox:"0 0 22 22"},l().createElement("g",{fill:"#EF6C00"},l().createElement("path",{d:"M18.7 3.3v15.4H3.3V3.3h15.4m1.5-1.5H1.8v18.3h18.3l.1-18.3z"}),l().createElement("path",{d:"M16.5 16.5l-5.4-4.3-5.6 4.3v-11h11z"}))),Je=l().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",viewBox:"0 0 22 22"},l().createElement("path",{fill:"#616161",d:"M19.3 8.2l-5.5-5.5c-.3-.3-.7-.5-1.2-.5H3.9c-.8.1-1.6.9-1.6 1.8v14.1c0 .9.7 1.6 1.6 1.6h14.2c.9 0 1.6-.7 1.6-1.6V9.4c.1-.5-.1-.9-.4-1.2zm-5.8-3.3l3.4 3.6h-3.4V4.9zm3.9 12.7H4.7c-.1 0-.2 0-.2-.2V4.7c0-.2.1-.3.2-.3h7.2v4.4s0 .8.3 1.1c.3.3 1.1.3 1.1.3h4.3v7.2s-.1.2-.2.2z"})),qe=e=>{const[t,n]=(0,c.useContext)(Re),a=null==t.dataSetType?[]:t.dataSetType.propertyAssignments;let s;t.panel.model.metadata.keys().includes("datasets")||t.panel.model.metadata.set("datasets",{}),s=t.panel.model.metadata.keys().includes("datasets")?Object.keys(t.panel.model.metadata.get("datasets")):[];const o=t.currentDirectoryContent.filter((e=>"directory"===e.type)),d=t.currentDirectoryContent.filter((e=>"directory"!==e.type)),u=""==t.error&&t.selectedFiles.length>0&&!t.uploadInProgress;return l().createElement("div",{id:"jupyterlab-openbis-upload-dialog",className:"jupyterlab-openbis-dialog"},""!==t.error&&l().createElement("div",{className:"main-error"},t.error),""===t.error&&null!=t.connection&&l().createElement("div",{className:"main-info"},"Connected to openBIS '",t.connection.name,"' (",t.connection.url,")"),l().createElement("div",{className:"row"},l().createElement("div",{className:"label"},"Select dataset type"),l().createElement("div",{className:"select"},l().createElement("select",{onChange:e=>n(new Ue(e.target.value))},t.dataSetTypes.map((e=>l().createElement("option",{key:e.code,value:e.permId},e.permId,null!=e.description&&e.description.length>0?": "+e.description:"")))),l().createElement("div",{className:"message-info"}))),a.map((e=>l().createElement("div",{className:"row",key:e.code},l().createElement("div",{className:"label"},e.label),l().createElement(ge,{context:Re,updateAction:t=>new _e(e.code,t),placeholder:e.description,field:t=>t.properties[e.code]})))),l().createElement("div",{className:"row"},l().createElement("div",{className:"label"},"Sample/experiment identifier"),l().createElement(ge,{context:Re,updateAction:e=>new Fe(e),placeholder:"Sample or experiment identifier/permId to attach this dataset to",field:e=>e.targetEntity})),s.length>0&&""===t.error&&l().createElement(l().Fragment,null,l().createElement("div",{className:"header"},"Parent datasets"),l().createElement(r,{className:"openbis-table openbis-table-bordered openbis-table-striped upload-table"},s.map(((e,a)=>l().createElement(i,{key:a,growIndex:1},l().createElement("input",{type:"checkbox",checked:t.selectedDataSets.includes(e),onChange:t=>n(t.target.checked?new je(e):new Me(e))}),l().createElement("div",{className:"text-left"},e)))))),null!=t.currentDirectoryContent&&t.currentDirectoryContent.length>0&&""==t.error&&l().createElement(l().Fragment,null,l().createElement("div",{className:"header"},"Files to upload"),l().createElement(r,{className:"openbis-table openbis-table-bordered openbis-table-striped upload-table"},""!==t.currentDirectory&&l().createElement(i,{growIndex:2},l().createElement("div",null),l().createElement("div",{className:"pointer",onClick:()=>n(new We)},$e),l().createElement("div",{className:"pointer text-left",onClick:()=>n(new We)},".."),l().createElement("div",null)),o.map(((e,t)=>l().createElement(i,{key:t,growIndex:2},l().createElement("div",null),l().createElement("div",{className:"pointer",onClick:()=>n(new Le(e.path))},$e),l().createElement("div",{className:"pointer text-left",onClick:()=>n(new Le(e.path))},e.name),l().createElement("div",null)))),d.map(((e,a)=>l().createElement(i,{key:a,growIndex:2},l().createElement("input",{type:"checkbox",checked:t.selectedFiles.includes(e.path),onChange:t=>n(t.target.checked?new Ke(e.path):new ze(e.path))}),"notebook"===e.type?Ge:Je,l().createElement("div",{className:"text-left"},e.name),l().createElement("div",null,e.size)))))),l().createElement(ye,{context:Re,isActive:u,commandAction:Ve},"Upload"),l().createElement("div",{className:"upload-message"},t.uploadInProgress?"Uploading dataset":t.uploadMessage))},Ye=(0,L.produce)(((e,t)=>{if(t instanceof _){const n=t.panelId;if(n in p){const{selected:t,connections:a}=p[n];if(t in a){const n=a[t];e.connection&&n.name!==e.connection.name&&Object.assign(e,Pe),"connected"!==n.status?e.error="Please authenticate the selected connection":e.error="",e.connection=n}else e.error="Please select a connection"}else e.error="Please select a connection"}if(t instanceof Be&&t.success&&(e.dataSetTypes=t.dataSetTypes),t instanceof Ue){const n=e.dataSetTypes.find((e=>e.code===t.code));e.dataSetType=n,e.properties={},e.dataSetType.propertyAssignments.forEach((t=>e.properties[t.code]=K))}if(t instanceof _e&&(e.properties[t.code].value=t.value),t instanceof Fe&&(e.targetEntity.value=t.value),t instanceof Le&&(e.currentDirectory=t.path),t instanceof Qe&&t.success&&(e.currentDirectoryContent=t.entries),t instanceof je&&e.selectedDataSets.push(t.permId),t instanceof Me&&(e.selectedDataSets=e.selectedDataSets.filter((e=>e!==t.permId))),t instanceof Ke&&e.selectedFiles.push(t.path),t instanceof ze&&(e.selectedFiles=e.selectedFiles.filter((e=>e!==t.path))),t instanceof Ve&&(e.uploadInProgress=!0),t instanceof He)if(e.uploadInProgress=!1,t.success)e.uploadMessage=t.value.statusText;else if("errors"in t.value)try{const n=Object.keys(t.value.errors[0])[0];e.uploadMessage=n+": "+t.value.errors[0][n]}catch(t){e.uploadMessage="Upload failed"}else e.uploadMessage="Upload failed"})),Xe=e=>t=>n=>{if(n instanceof _&&(e(new Oe),null!=t.currentDirectory&&""!==t.currentDirectory||e(new Le(""))),n instanceof F&&(Ae[n.panelId]=t),n instanceof Oe&&null!=t.connection){const n="openbis/datasetTypes/"+t.connection.name;e(new $(n,((e,t)=>new Be(t.dataSetTypes,200===e)),(e=>new Be(e,!1))))}if(n instanceof Be&&n.success&&n.dataSetTypes.length>0&&(null!=t.dataSetType&&n.dataSetTypes.find((e=>e.code===t.dataSetType.code))||e(new Ue(n.dataSetTypes[0].code))),n instanceof Le&&null!=t.connection){const t="api/contents/"+n.path;e(new $(t,((e,t)=>new Qe(t.content,200===e)),(e=>new Qe(e,!1))))}if(n instanceof We&&""!==t.currentDirectory&&(-1!==t.currentDirectory.indexOf("/")?e(new Le(t.currentDirectory.substring(0,t.currentDirectory.indexOf("/")))):e(new Le(""))),n instanceof Ve){const n="openbis/dataset/"+t.connection.name,a={};Object.keys(t.properties).forEach((e=>{a[e]=t.properties[e].value}));const s={type:t.dataSetType.permId,files:t.selectedFiles,parents:t.selectedDataSets,entityIdentifier:t.targetEntity.value,props:a};e(new J(n,JSON.stringify(s),((e,t)=>new He(t,200==e)),(e=>new He(e,!1))))}},Ze=e=>{const[t,n]=(0,c.useReducer)(Ye,e.initialState),a=z(t,n,e.getDispatch,Y,Xe);return(0,c.useLayoutEffect)((()=>{e.setDispatch(a)})),(0,c.useEffect)((()=>{e.getDispatch()(new _(e.id))}),[]),l().createElement(Re.Provider,{value:[t,a]},e.children)};class et extends j{constructor(e){super(e),this.panel.id in Ae||(Ae[this.panel.id]=Pe,Ae[this.panel.id].panel=this.panel)}render(){return c.createElement(Ze,{id:this.panel.id,initialState:Ae[this.panel.id],setDispatch:this.setDispatch,getDispatch:this.getDispatch},c.createElement(qe,null))}}const tt={activate:function(e,t,n){e.docRegistry.addWidgetExtension("Notebook",new nt)},id:"jupyterlab-openbis:dialogs",autoStart:!0,requires:[o.INotebookTracker,s.IThemeManager]};s.Dialog.prototype._evtKeydownOriginal=s.Dialog.prototype._evtKeydown,s.Dialog.prototype._evtKeydown=function(e){13===e.keyCode&&Object.keys(p).includes(this._body.panel.id)||this._evtKeydownOriginal(e)};class nt{createNew(e,t){const n=new ee(e),o=new Te(e),c=new et(e);let l=(e,t)=>()=>{(0,s.showDialog)({title:t,body:e,buttons:[s.Dialog.okButton({label:"Close"})]})};const r=new s.ToolbarButton({iconClass:"fa fa-sliders-h openbis-toolbar-button",onClick:l(n,"openBIS connections"),tooltip:"Choose openBIS connection"}),i=new s.ToolbarButton({className:"myButton",iconClass:"fa fa-download openbis-toolbar-button",onClick:l(o,"Download openBIS datasets"),tooltip:"Download openBIS datasets"}),d=new s.ToolbarButton({className:"myButton",iconClass:"fa fa-upload openbis-toolbar-button",onClick:l(c,"Upload openBIS datasets"),tooltip:"Upload openBIS datasets"});return e.toolbar.insertItem(9,"connections",r),e.toolbar.insertItem(10,"download",i),e.toolbar.insertItem(11,"upload",d),new a.DisposableDelegate((()=>{delete p[e.id],delete ne[e.id],delete Ae[e.id],r.dispose(),i.dispose(),d.dispose()}))}}const at=tt},184:(e,t)=>{var n;!function(){"use strict";var a={}.hasOwnProperty;function s(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(n){var o=typeof n;if("string"===o||"number"===o)e.push(n);else if(Array.isArray(n)&&n.length){var c=s.apply(null,n);c&&e.push(c)}else if("object"===o)for(var l in n)a.call(n,l)&&n[l]&&e.push(l)}}return e.join(" ")}e.exports?(s.default=s,e.exports=s):void 0===(n=function(){return s}.apply(t,[]))||(e.exports=n)}()}}]);
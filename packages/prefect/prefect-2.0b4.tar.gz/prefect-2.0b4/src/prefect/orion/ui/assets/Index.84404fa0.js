import{d as P,c as C,e as n,O as w,P as b,L as B,Z as le,o as u,l as U,u as ae,$ as re,y as $,h as m,p as t,i as r,w as c,j as e,V as ue,a0 as Y,a1 as Z,a2 as ie,H as R,X as v,a3 as ce,a4 as _e,a5 as de,a6 as pe,N as fe,Q as me,M as ve,a7 as he,F as ge,Y as ye,a8 as we,a9 as z,aa as be,U as k,ab as J}from"./index.d7f95bb7.js";import{R as xe,M as ke}from"./Radar.d543e35f.js";import{T as Re}from"./Timeline.cc1f2db2.js";const $e=P({props:{id:null},setup(F){const h=F,g=C(new xe),p=n(()=>({id:h.id})),f={radar:w.query({endpoint:b.radar,body:p,options:{pollInterval:5e3}})};return B(()=>{var l;return(l=f.radar.response)==null?void 0:l.value},l=>{l&&g.value.items(l)}),le(()=>{g.value.id("id").dependencies("upstream_dependencies").items([])}),(l,D)=>(u(),U(ke,{id:F.id,radar:g.value,"hide-viewport":"","disable-interactions":""},null,8,["id","radar"]))}});const Fe={class:"flow-run-logs-tabs-content"},Te={class:"flow-run-logs-tabs-content__header"},Ie=v(" Copy Logs "),Le={class:"flow-run-logs-tab-content__table"},Ne=ce('<div class="flow-run-logs-tab-content__table-header"><span class="flow-run-logs-tab-content__column flow-run-logs-tab-content__column--level"> Level </span><span class="flow-run-logs-tab-content__column flow-run-logs-tab-content__column--time"> Time </span><span class="flow-run-logs-tab-content__column flow-run-logs-tab-content__column--message"> Message </span><span class="flow-run-logs-tab-content__column flow-run-logs-tab-content__column-run"> Run name </span></div>',1),Se={class:"flow-run_logs-tab-content__empty"},qe=v(" No logs to show. "),Ce=v(" Try clearing your filter "),Be={key:0,class:"flow-run-logs-tabs-content__loading"},De=P({props:{flowRunId:{type:String,required:!0},running:{type:Boolean}},setup(F){const h=F,g=C(),p=[{label:"Critical only",value:50},{label:"Error and above",value:40},{label:"Warning and above",value:30},{label:"Info and above",value:20},{label:"Debug and above",value:10},{label:"All log levels",value:0}],f=C(0),l=n(()=>({logs:{flow_run_id:{any_:[h.flowRunId]},level:{ge_:f.value}}})),D={interval:h.running?5e3:void 0},_=ae(re.getLogs,[l],D),V=n(()=>{var o;return(o=_.response)!=null?o:[]}),T=n(()=>{var o;return(o=_.loading)!=null?o:!0}),L=()=>{f.value=0},A=()=>{if(!g.value)return;const o=g.value,y=o.scrollTop>0,x=o.scrollTop+o.offsetHeight===o.scrollHeight;y&&x&&_e(()=>{o.scrollTop=o.scrollHeight})},H=()=>V.value.map(o=>{const y=de(o.level),x=pe(o.timestamp);return`${y}	${x}	${o.message}`}).join(`
`);return B(()=>h.running,()=>_.unsubscribe()),B(()=>_.response,()=>A()),(o,y)=>{const x=$("m-select"),a=$("m-button"),N=$("m-loader");return u(),m("div",Fe,[t("div",Te,[r(x,{modelValue:f.value,"onUpdate:modelValue":y[0]||(y[0]=E=>f.value=E),options:p,class:"flow-run-logs-tabs-content__filter"},null,8,["modelValue"]),r(e(ue),{text:"",value:H,class:"flow-run-logs__copy",toast:"Logs copied to clipboard"},{default:c(()=>[Ie]),_:1})]),t("div",Le,[Ne,t("div",{ref_key:"logsRef",ref:g,class:"flow-run-logs-tab-content__logs"},[r(e(ie),{logs:e(V)},{empty:c(()=>[t("p",Se,[qe,Y(r(a,{class:"ml-2",onClick:L},{default:c(()=>[Ce]),_:1},512),[[Z,f.value]])])]),_:1},8,["logs"]),F.running||e(T)?(u(),m("div",Be,[r(N,{loading:!0,class:"flow-run-logs-tabs-content__loader"}),Y(t("span",null,"Run in progress...",512),[[Z,F.running]])])):R("",!0)],512)])])}}});const Ve={class:"main-grid"},Ee={class:"d-flex align-center justify-space-between py-1 px-2"},je={class:"d-inline-flex flex-column"},Ue={class:"flex-grow-0 flex-shrink-1"},Ae={class:"d-inline-flex align-center text-truncate"},He={class:"caption font--primary font-weight-semibold text--grey-40 d-flex text-truncate"},Me={key:0},Pe=v(" Started: "),Ge={class:"text--grey-80 mr-1 ml--half"},Oe={key:1},We=v(" Ended: "),Qe={class:"text--grey-80 mr-1 ml--half"},Xe={class:"caption font--primary font-weight-semibold text--grey-40 mt-1 d-flex text-truncate"},Ye={key:0},Ze=v(" Deployment: "),ze={class:"text--grey-80 mr-1 ml--half"},Je={key:1},Ke=v(" Parent: "),et={class:"text--grey-80"},tt=v(" /"),st={key:2},nt=v(" Results: "),ot={class:"text--grey-80 mr-1 ml--half"},lt={key:3},at=v(" Flow version: "),rt={class:"text--grey-80 mr-1 ml--half"},ut={class:"font--secondary"},it={class:"d-flex align-center justify-space-between py-1 px-2"},ct=t("div",{class:"subheader"}," Timeline ",-1),_t={class:"timeline-content pb-2 px-2 d-flex flex-grow-1"},dt={class:"d-flex align-center justify-space-between py-1 px-2"},pt=t("div",{class:"subheader"}," Radar ",-1),ft={class:"radar-content pb-2 px-2 d-flex flex-grow-1"},mt={class:"flow-run__tab-content"},vt={class:"results-section"},ht={key:1,class:"text-center my-8"},gt=t("h2",null,"No results found",-1),yt=[gt],wt={class:"results-section"},bt={key:1,class:"text-center my-8"},xt=t("h2",null,"No results found",-1),kt=[xt],Rt=t("hr",{class:"results-hr mt-3"},null,-1),It=P({async setup(F){let h,g;const p=ye(),f=C("logs"),l=C(p==null?void 0:p.params.id),D=n(()=>({id:l.value})),_=([h,g]=fe(()=>w.query({endpoint:b.flow_run,body:D,options:{pollInterval:5e3}}).fetch()),h=await h,g(),h),V=n(()=>_.response.value.flow_id),T=n(()=>_.response.value.parent_task_run_id),L=n(()=>_.response.value.deployment_id),A=n(()=>({id:V.value})),H=n(()=>({id:L.value})),o=n(()=>({task_runs:{id:{any_:[T.value]}}})),y=n(()=>({flow_runs:{id:{any_:[l.value]}}})),x=n(()=>({flow_runs:{id:{any_:[l.value]}},task_runs:{subflow_runs:{exists_:!0}}})),a={flow:w.query({endpoint:b.flow,body:A}),deployment:w.query({endpoint:b.deployment,body:H,options:{paused:!L.value}}),parent_flow:w.query({endpoint:b.flows,body:o,options:{paused:!T.value}}),parent_flow_run:w.query({endpoint:b.flow_runs,body:o,options:{paused:!T.value}}),task_runs_count:w.query({endpoint:b.task_runs_count,body:y,options:{pollInterval:1e4}}),task_runs:w.query({endpoint:b.task_runs,body:y,options:{pollInterval:1e4}}),sub_flow_runs_count:w.query({endpoint:b.task_runs_count,body:x,options:{pollInterval:1e4}})},N=n(()=>{var s;return((s=a.deployment.response)==null?void 0:s.value)||{}}),E=n(()=>{var s,i;return((i=(s=a.parent_flow.response)==null?void 0:s.value)==null?void 0:i[0])||{}}),G=n(()=>{var s,i;return((i=(s=a.parent_flow_run.response)==null?void 0:s.value)==null?void 0:i[0])||{}}),O=n(()=>{var s,i;return(i=(s=N.value)==null?void 0:s.flow_data)==null?void 0:i.blob}),d=n(()=>{var s;return((s=_.response)==null?void 0:s.value)||{}}),K=n(()=>d.value.end_time),S=n(()=>{var s;return(s=d.value)==null?void 0:s.state}),ee=n(()=>S.value.type==we.RUNNING),te=n(()=>{var s;return((s=d.value)==null?void 0:s.tags)||[]}),W=n(()=>{var s;return((s=a.task_runs.response)==null?void 0:s.value)||[]}),se=n(()=>{var s,i,j,I;return[{title:"Logs",key:"logs",icon:"pi-logs-fill",count:null},{title:"Task Runs",key:"task_runs",icon:"pi-task",count:(i=(s=a.task_runs_count.response)==null?void 0:s.value)!=null?i:0},{title:"Subflow Runs",key:"sub_flow_runs",icon:"pi-flow-run",count:(I=(j=a.sub_flow_runs_count.response)==null?void 0:j.value)!=null?I:0}]}),ne=n(()=>S.value.type=="PENDING"||S.value.type=="SCHEDULED"?"--":d.value.total_run_time?z(d.value.total_run_time):z(d.value.estimated_run_time));me(()=>{_.stopPolling(),w.queries.delete(_.id)});const oe=B(p,()=>{l.value=p==null?void 0:p.params.id});return ve(()=>{oe()}),B(l,async()=>{!l.value||(await _.fetch(),a.flow.fetch(),a.task_runs_count.fetch(),a.task_runs.fetch(),a.sub_flow_runs_count.fetch(),L.value?a.deployment.fetch():a.deployment.clearResult(),T.value?a.parent_flow.fetch():a.parent_flow.clearResult(),T.value?a.parent_flow_run.fetch():a.parent_flow_run.clearResult(),f.value="task_runs")}),(s,i)=>{const j=$("m-tags"),I=$("router-link"),M=$("m-card"),Q=$("m-icon-button"),X=$("ResultsList");return u(),m(ge,null,[t("div",Ve,[r(M,{class:"details",shadow:"sm"},{default:c(()=>[t("div",Ee,[t("div",je,[t("div",Ue,[t("span",Ae,[r(be,{name:e(S).name,type:e(S).type,class:"mr-1"},null,8,["name","type"]),r(j,{tags:e(te),class:"mr-1 caption"},null,8,["tags"]),t("div",He,[e(d).start_time?(u(),m("span",Me,[Pe,t("span",Ge,k(e(J)(e(d).start_time)),1)])):R("",!0),e(d).end_time?(u(),m("span",Oe,[We,t("span",Qe,k(e(J)(e(d).end_time)),1)])):R("",!0)])])]),t("div",Xe,[e(N).name?(u(),m("span",Ye,[Ze,t("span",ze,k(e(N).name),1)])):R("",!0),e(E).name?(u(),m("span",Je,[Ke,t("span",et,k(e(E).name),1),tt,r(I,{to:`/flow-run/${e(G).id}`,class:"mr-1 ml--half text--primary"},{default:c(()=>[v(k(e(G).name),1)]),_:1},8,["to"])])):R("",!0),e(O)?(u(),m("span",st,[nt,t("span",ot,k(e(O)),1)])):R("",!0),e(d).flow_version?(u(),m("span",lt,[at,t("span",rt,k(e(d).flow_version),1)])):R("",!0)])]),t("div",ut,k(e(ne)),1)])]),_:1}),r(M,{class:"timeline d-flex flex-column",width:"auto",shadow:"sm"},{header:c(()=>[t("div",it,[ct,r(I,{to:`/flow-run/${l.value}/timeline`},{default:c(()=>[r(Q,{icon:"pi-full-screen"})]),_:1},8,["to"])])]),default:c(()=>[t("div",_t,[e(W).length?(u(),U(Re,{key:0,items:e(W),"max-end-time":e(K),"hide-header":"","axis-position":"bottom","background-color":"blue-5"},null,8,["items","max-end-time"])):R("",!0)])]),_:1}),r(M,{class:"radar",shadow:"sm"},{header:c(()=>[t("div",dt,[pt,r(I,{to:`/flow-run/${l.value}/radar`},{default:c(()=>[r(Q,{icon:"pi-full-screen"})]),_:1},8,["to"])])]),default:c(()=>[t("div",ft,[r($e,{id:l.value},null,8,["id"])])]),_:1})]),r(e(he),{value:f.value,"onUpdate:value":i[0]||(i[0]=q=>f.value=q),tabs:e(se),class:"mt-3"},{logs:c(()=>[t("section",mt,[r(De,{"flow-run-id":l.value,running:e(ee)},null,8,["flow-run-id","running"])])]),task_runs:c(({tab:q})=>[t("section",vt,[q.count>0?(u(),U(X,{key:"task_runs",filter:e(y),component:"ListItemTaskRun",endpoint:"task_runs","poll-interval":5e3},null,8,["filter"])):(u(),m("div",ht,yt))])]),sub_flow_runs:c(({tab:q})=>[t("section",wt,[q.count>0?(u(),U(X,{key:"sub_flow_runs",filter:e(x),component:"ListItemSubFlowRun",endpoint:"task_runs","poll-interval":5e3},null,8,["filter"])):(u(),m("div",bt,kt))])]),_:1},8,["value","tabs"]),Rt],64)}}});export{It as default};
